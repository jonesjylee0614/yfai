<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¿æ¥å™¨ - AI æ§åˆ¶å°</title>
    <link rel="stylesheet" href="assets/common.css">
    <style>
        body {
            margin: 0;
            padding: 0;
            background: var(--bg-darker);
            color: var(--text-primary);
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
        }

        .container {
            display: flex;
            height: 100vh;
        }

        /* ä¾§è¾¹æ  */
        .sidebar {
            width: 240px;
            background: var(--bg-dark);
            border-right: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
        }

        .sidebar-header {
            padding: 20px;
            border-bottom: 1px solid var(--border-color);
        }

        .sidebar-header h2 {
            margin: 0 0 10px 0;
            font-size: 18px;
            color: var(--text-primary);
        }

        .nav-item {
            padding: 12px 20px;
            cursor: pointer;
            transition: all 0.2s;
            border-left: 3px solid transparent;
        }

        .nav-item:hover {
            background: var(--bg-light);
        }

        .nav-item.active {
            background: var(--bg-light);
            border-left-color: var(--primary-color);
            color: var(--primary-color);
        }

        /* ä¸»å†…å®¹åŒº */
        .main-content {
            flex: 1;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .header {
            background: var(--bg-dark);
            border-bottom: 1px solid var(--border-color);
            padding: 20px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            margin: 0;
            font-size: 24px;
            color: var(--text-primary);
        }

        .header-actions {
            display: flex;
            gap: 10px;
        }

        .content-area {
            flex: 1;
            overflow-y: auto;
            padding: 30px;
        }

        /* è¿æ¥å™¨ç±»å‹å¡ç‰‡ */
        .connector-types {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .type-card {
            background: var(--bg-dark);
            border: 2px dashed var(--border-color);
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .type-card:hover {
            border-color: var(--primary-color);
            background: var(--bg-light);
        }

        .type-icon {
            font-size: 40px;
            margin-bottom: 10px;
        }

        .type-name {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .type-description {
            font-size: 12px;
            color: var(--text-secondary);
        }

        /* è¿æ¥å™¨åˆ—è¡¨ */
        .connectors-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
        }

        .connector-card {
            background: var(--bg-dark);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 20px;
            transition: all 0.3s;
        }

        .connector-card:hover {
            border-color: var(--primary-color);
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.3);
        }

        .connector-header {
            display: flex;
            align-items: flex-start;
            gap: 15px;
            margin-bottom: 15px;
        }

        .connector-icon {
            font-size: 32px;
        }

        .connector-info {
            flex: 1;
        }

        .connector-name {
            font-size: 18px;
            font-weight: 600;
            margin: 0 0 8px 0;
        }

        .connector-type {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .connector-status {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            background: var(--bg-darker);
            border-radius: 6px;
            font-size: 13px;
            margin-bottom: 15px;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }

        .status-dot.connected {
            background: var(--success-color);
            box-shadow: 0 0 8px var(--success-color);
        }

        .status-dot.disconnected {
            background: var(--danger-color);
        }

        .status-dot.testing {
            background: var(--warning-color);
            animation: pulse 1.5s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.3;
            }
        }

        .connector-meta {
            display: flex;
            flex-direction: column;
            gap: 8px;
            font-size: 13px;
            color: var(--text-secondary);
            margin-bottom: 15px;
        }

        .meta-row {
            display: flex;
            justify-content: space-between;
        }

        .connector-actions {
            display: flex;
            gap: 10px;
            padding-top: 15px;
            border-top: 1px solid var(--border-color);
        }

        /* æ¨¡æ€æ¡† */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.7);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: var(--bg-dark);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            width: 90%;
            max-width: 700px;
            max-height: 90vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .modal-header {
            padding: 20px 30px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h2 {
            margin: 0;
            font-size: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .modal-body {
            padding: 30px;
            overflow-y: auto;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: var(--text-primary);
            font-weight: 500;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 10px 12px;
            background: var(--bg-darker);
            border: 1px solid var(--border-color);
            border-radius: 4px;
            color: var(--text-primary);
            font-size: 14px;
        }

        .form-group textarea {
            min-height: 100px;
            resize: vertical;
            font-family: 'Consolas', 'Monaco', monospace;
        }

        .form-help {
            font-size: 12px;
            color: var(--text-secondary);
            margin-top: 5px;
        }

        .test-result {
            padding: 15px;
            border-radius: 6px;
            margin-top: 15px;
            font-size: 14px;
        }

        .test-result.success {
            background: rgba(82, 196, 26, 0.1);
            border: 1px solid var(--success-color);
            color: var(--success-color);
        }

        .test-result.error {
            background: rgba(255, 77, 79, 0.1);
            border: 1px solid var(--danger-color);
            color: var(--danger-color);
        }

        .modal-footer {
            padding: 20px 30px;
            border-top: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .close-btn {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 24px;
            cursor: pointer;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 4px;
            transition: all 0.2s;
        }

        .close-btn:hover {
            background: var(--bg-light);
            color: var(--text-primary);
        }

        .config-template {
            background: var(--bg-darker);
            padding: 15px;
            border-radius: 6px;
            border: 1px solid var(--border-color);
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 12px;
            color: var(--text-secondary);
            margin-top: 10px;
        }

        .section-title {
            font-size: 16px;
            font-weight: 600;
            margin: 30px 0 15px 0;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border-color);
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- ä¾§è¾¹æ  -->
        <div class="sidebar">
            <div class="sidebar-header">
                <h2>ğŸ  AI æ§åˆ¶å°</h2>
                <div style="font-size: 12px; color: var(--text-secondary);">è¿æ¥å™¨ç®¡ç†</div>
            </div>
            <div class="nav-item" onclick="window.location.href='agents-center.html'">ğŸ¤– æ™ºèƒ½ä½“ä¸­å¿ƒ</div>
            <div class="nav-item" onclick="window.location.href='index.html'">ğŸ’¬ å¯¹è¯</div>
            <div class="nav-item" onclick="window.location.href='assistants.html'">ğŸ¯ åŠ©æ‰‹</div>
            <div class="nav-item" onclick="window.location.href='automation.html'">âš¡ è‡ªåŠ¨åŒ–</div>
            <div class="nav-item" onclick="window.location.href='jobs.html'">ğŸ“Š è¿è¡Œè®°å½•</div>
            <div class="nav-item" onclick="window.location.href='knowledge.html'">ğŸ“š çŸ¥è¯†åº“</div>
            <div class="nav-item active">ğŸ”Œ è¿æ¥å™¨</div>
            <div class="nav-item" onclick="window.location.href='sessions.html'">ğŸ“– ä¼šè¯</div>
            <div class="nav-item" onclick="window.location.href='logs.html'">ğŸ“‹ æ—¥å¿—</div>
            <div class="nav-item" onclick="window.location.href='settings.html'">âš™ï¸ è®¾ç½®</div>
        </div>

        <!-- ä¸»å†…å®¹åŒº -->
        <div class="main-content">
            <div class="header">
                <div>
                    <h1>ğŸ”Œ è¿æ¥å™¨ç®¡ç†</h1>
                    <div style="color: var(--text-secondary); margin-top: 5px; font-size: 14px;">
                        ç»Ÿä¸€ç®¡ç†å¤–éƒ¨æœåŠ¡å’Œç³»ç»Ÿé›†æˆ
                    </div>
                </div>
                <div class="header-actions">
                    <button class="btn btn-secondary" onclick="importConnector()">
                        ğŸ“¥ å¯¼å…¥é…ç½®
                    </button>
                </div>
            </div>

            <div class="content-area">
                <!-- æ–°å¢è¿æ¥å™¨ç±»å‹ -->
                <div class="section-title">â• æ·»åŠ æ–°è¿æ¥å™¨</div>
                <div class="connector-types">
                    <div class="type-card" onclick="createConnector('email')">
                        <div class="type-icon">ğŸ“§</div>
                        <div class="type-name">é‚®ä»¶æœåŠ¡</div>
                        <div class="type-description">æ”¶å‘é‚®ä»¶ã€æœç´¢</div>
                    </div>
                    <div class="type-card" onclick="createConnector('git')">
                        <div class="type-icon">ğŸ”€</div>
                        <div class="type-name">Git ä»“åº“</div>
                        <div class="type-description">ä»£ç ç®¡ç†ã€æäº¤</div>
                    </div>
                    <div class="type-card" onclick="createConnector('http')">
                        <div class="type-icon">ğŸŒ</div>
                        <div class="type-name">HTTP API</div>
                        <div class="type-description">REST/GraphQL</div>
                    </div>
                    <div class="type-card" onclick="createConnector('database')">
                        <div class="type-icon">ğŸ—„ï¸</div>
                        <div class="type-name">æ•°æ®åº“</div>
                        <div class="type-description">SQL æŸ¥è¯¢ã€å¤‡ä»½</div>
                    </div>
                    <div class="type-card" onclick="createConnector('cloud')">
                        <div class="type-icon">â˜ï¸</div>
                        <div class="type-name">äº‘å­˜å‚¨</div>
                        <div class="type-description">OSS/S3/MinIO</div>
                    </div>
                    <div class="type-card" onclick="createConnector('notes')">
                        <div class="type-icon">ğŸ“</div>
                        <div class="type-name">ç¬”è®°åº”ç”¨</div>
                        <div class="type-description">Notion/é£ä¹¦</div>
                    </div>
                </div>

                <!-- å·²æœ‰è¿æ¥å™¨ -->
                <div class="section-title">ğŸ”— å·²é…ç½®çš„è¿æ¥å™¨</div>
                <div class="connectors-grid" id="connectorsGrid">
                    <!-- è¿æ¥å™¨å¡ç‰‡å°†ç”± JS ç”Ÿæˆ -->
                </div>
            </div>
        </div>
    </div>

    <!-- åˆ›å»º/ç¼–è¾‘è¿æ¥å™¨æ¨¡æ€æ¡† -->
    <div class="modal" id="connectorModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle"><span id="modalIcon">ğŸ”Œ</span> åˆ›å»ºè¿æ¥å™¨</h2>
                <button class="close-btn" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="connectorForm">
                    <div class="form-group">
                        <label>è¿æ¥å™¨åç§° *</label>
                        <input type="text" id="connectorName" placeholder="ä¾‹å¦‚ï¼šå…¬å¸é‚®ç®±" required>
                    </div>

                    <div class="form-group">
                        <label>æè¿°</label>
                        <textarea id="connectorDescription" placeholder="æè¿°è¿™ä¸ªè¿æ¥å™¨çš„ç”¨é€”..." rows="2"></textarea>
                    </div>

                    <div id="configFields">
                        <!-- é…ç½®å­—æ®µå°†æ ¹æ®ç±»å‹åŠ¨æ€ç”Ÿæˆ -->
                    </div>

                    <div class="form-group" id="testResultContainer" style="display: none;">
                        <div id="testResult"></div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="testConnection()">
                    ğŸ” æµ‹è¯•è¿æ¥
                </button>
                <div style="display: flex; gap: 10px;">
                    <button class="btn btn-secondary" onclick="closeModal()">å–æ¶ˆ</button>
                    <button class="btn btn-primary" onclick="saveConnector()">ä¿å­˜</button>
                </div>
            </div>
        </div>
    </div>

    <script src="assets/common.js"></script>
    <script>
        // ç¤ºä¾‹æ•°æ®
        const connectors = [
            {
                id: 'conn-1',
                name: 'å…¬å¸é‚®ç®±',
                type: 'email',
                icon: 'ğŸ“§',
                status: 'connected',
                config: {
                    server: 'smtp.company.com',
                    port: 587,
                    username: 'user@company.com'
                },
                lastUsed: '2 å°æ—¶å‰',
                callCount: 45
            },
            {
                id: 'conn-2',
                name: 'é¡¹ç›®ä»£ç ä»“åº“',
                type: 'git',
                icon: 'ğŸ”€',
                status: 'connected',
                config: {
                    url: 'https://github.com/company/project.git',
                    branch: 'main'
                },
                lastUsed: '30 åˆ†é’Ÿå‰',
                callCount: 128
            },
            {
                id: 'conn-3',
                name: 'ç¬¬ä¸‰æ–¹ API',
                type: 'http',
                icon: 'ğŸŒ',
                status: 'connected',
                config: {
                    baseUrl: 'https://api.example.com',
                    auth: 'Bearer token'
                },
                lastUsed: '1 å°æ—¶å‰',
                callCount: 234
            },
            {
                id: 'conn-4',
                name: 'ç”Ÿäº§æ•°æ®åº“',
                type: 'database',
                icon: 'ğŸ—„ï¸',
                status: 'connected',
                config: {
                    host: 'db.company.com',
                    port: 5432,
                    database: 'production'
                },
                lastUsed: '5 åˆ†é’Ÿå‰',
                callCount: 89
            },
            {
                id: 'conn-5',
                name: 'OSS å­˜å‚¨',
                type: 'cloud',
                icon: 'â˜ï¸',
                status: 'disconnected',
                config: {
                    endpoint: 'oss-cn-hangzhou.aliyuncs.com',
                    bucket: 'my-bucket'
                },
                lastUsed: '3 å¤©å‰',
                callCount: 12
            },
            {
                id: 'conn-6',
                name: 'Notion å·¥ä½œåŒº',
                type: 'notes',
                icon: 'ğŸ“',
                status: 'connected',
                config: {
                    apiKey: '***',
                    workspace: 'My Workspace'
                },
                lastUsed: 'æ˜¨å¤©',
                callCount: 34
            }
        ];

        let currentConnectorType = null;

        // é…ç½®æ¨¡æ¿
        const configTemplates = {
            email: {
                fields: [
                    { name: 'server', label: 'SMTP æœåŠ¡å™¨', type: 'text', placeholder: 'smtp.gmail.com' },
                    { name: 'port', label: 'ç«¯å£', type: 'number', placeholder: '587' },
                    { name: 'username', label: 'ç”¨æˆ·å', type: 'text', placeholder: 'user@example.com' },
                    { name: 'password', label: 'å¯†ç ', type: 'password', placeholder: '***' },
                    { name: 'useTLS', label: 'ä½¿ç”¨ TLS', type: 'checkbox' }
                ]
            },
            git: {
                fields: [
                    { name: 'url', label: 'ä»“åº“ URL', type: 'text', placeholder: 'https://github.com/user/repo.git' },
                    { name: 'branch', label: 'é»˜è®¤åˆ†æ”¯', type: 'text', placeholder: 'main' },
                    { name: 'username', label: 'ç”¨æˆ·å', type: 'text', placeholder: 'git username' },
                    { name: 'token', label: 'è®¿é—®ä»¤ç‰Œ', type: 'password', placeholder: 'Personal Access Token' }
                ]
            },
            http: {
                fields: [
                    { name: 'baseUrl', label: 'Base URL', type: 'text', placeholder: 'https://api.example.com' },
                    { name: 'authType', label: 'è®¤è¯ç±»å‹', type: 'select', options: ['None', 'Bearer Token', 'API Key', 'Basic Auth'] },
                    { name: 'authValue', label: 'è®¤è¯å€¼', type: 'password', placeholder: 'Token or API Key' },
                    { name: 'headers', label: 'è‡ªå®šä¹‰ Headers (JSON)', type: 'textarea', placeholder: '{"Content-Type": "application/json"}' }
                ]
            },
            database: {
                fields: [
                    { name: 'type', label: 'æ•°æ®åº“ç±»å‹', type: 'select', options: ['PostgreSQL', 'MySQL', 'SQLite', 'MongoDB'] },
                    { name: 'host', label: 'ä¸»æœº', type: 'text', placeholder: 'localhost' },
                    { name: 'port', label: 'ç«¯å£', type: 'number', placeholder: '5432' },
                    { name: 'database', label: 'æ•°æ®åº“å', type: 'text', placeholder: 'mydb' },
                    { name: 'username', label: 'ç”¨æˆ·å', type: 'text', placeholder: 'dbuser' },
                    { name: 'password', label: 'å¯†ç ', type: 'password', placeholder: '***' }
                ]
            },
            cloud: {
                fields: [
                    { name: 'provider', label: 'äº‘æœåŠ¡å•†', type: 'select', options: ['é˜¿é‡Œäº‘ OSS', 'AWS S3', 'MinIO'] },
                    { name: 'endpoint', label: 'Endpoint', type: 'text', placeholder: 'oss-cn-hangzhou.aliyuncs.com' },
                    { name: 'bucket', label: 'Bucket åç§°', type: 'text', placeholder: 'my-bucket' },
                    { name: 'accessKey', label: 'Access Key', type: 'text', placeholder: 'LTAI...' },
                    { name: 'secretKey', label: 'Secret Key', type: 'password', placeholder: '***' }
                ]
            },
            notes: {
                fields: [
                    { name: 'provider', label: 'ç¬”è®°åº”ç”¨', type: 'select', options: ['Notion', 'é£ä¹¦æ–‡æ¡£', 'Confluence'] },
                    { name: 'apiKey', label: 'API Key', type: 'password', placeholder: 'secret_...' },
                    { name: 'workspace', label: 'å·¥ä½œåŒº', type: 'text', placeholder: 'My Workspace' },
                    { name: 'rootPage', label: 'æ ¹é¡µé¢ ID', type: 'text', placeholder: 'page-id' }
                ]
            }
        };

        // æ¸²æŸ“è¿æ¥å™¨åˆ—è¡¨
        function renderConnectors() {
            const grid = document.getElementById('connectorsGrid');
            if (connectors.length === 0) {
                grid.innerHTML = '<div style="grid-column: 1 / -1; text-align: center; padding: 60px; color: var(--text-secondary);">è¿˜æ²¡æœ‰é…ç½®ä»»ä½•è¿æ¥å™¨</div>';
                return;
            }

            grid.innerHTML = connectors.map(conn => `
                <div class="connector-card">
                    <div class="connector-header">
                        <div class="connector-icon">${conn.icon}</div>
                        <div class="connector-info">
                            <h3 class="connector-name">${conn.name}</h3>
                            <div class="connector-type">${getTypeName(conn.type)}</div>
                        </div>
                    </div>

                    <div class="connector-status">
                        <div class="status-dot ${conn.status}"></div>
                        <span>${conn.status === 'connected' ? 'âœ… å·²è¿æ¥' : 'âŒ æœªè¿æ¥'}</span>
                    </div>

                    <div class="connector-meta">
                        <div class="meta-row">
                            <span>æœ€åä½¿ç”¨:</span>
                            <span>${conn.lastUsed}</span>
                        </div>
                        <div class="meta-row">
                            <span>è°ƒç”¨æ¬¡æ•°:</span>
                            <span>${conn.callCount} æ¬¡</span>
                        </div>
                    </div>

                    <div class="connector-actions">
                        <button class="btn btn-sm btn-secondary" onclick="testConnector('${conn.id}')">
                            ğŸ” æµ‹è¯•
                        </button>
                        <button class="btn btn-sm btn-secondary" onclick="editConnector('${conn.id}')">
                            âœï¸ ç¼–è¾‘
                        </button>
                        <button class="btn btn-sm btn-danger" onclick="deleteConnector('${conn.id}')">
                            ğŸ—‘ï¸ åˆ é™¤
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function getTypeName(type) {
            const names = {
                'email': 'ğŸ“§ é‚®ä»¶æœåŠ¡',
                'git': 'ğŸ”€ Git ä»“åº“',
                'http': 'ğŸŒ HTTP API',
                'database': 'ğŸ—„ï¸ æ•°æ®åº“',
                'cloud': 'â˜ï¸ äº‘å­˜å‚¨',
                'notes': 'ğŸ“ ç¬”è®°åº”ç”¨'
            };
            return names[type] || type;
        }

        // åˆ›å»ºè¿æ¥å™¨
        function createConnector(type) {
            currentConnectorType = type;
            const icons = { email: 'ğŸ“§', git: 'ğŸ”€', http: 'ğŸŒ', database: 'ğŸ—„ï¸', cloud: 'â˜ï¸', notes: 'ğŸ“' };

            document.getElementById('modalIcon').textContent = icons[type];
            document.getElementById('modalTitle').innerHTML = `${icons[type]} åˆ›å»º ${getTypeName(type)}`;
            document.getElementById('connectorForm').reset();
            document.getElementById('testResultContainer').style.display = 'none';

            renderConfigFields(type);
            document.getElementById('connectorModal').classList.add('show');
        }

        // æ¸²æŸ“é…ç½®å­—æ®µ
        function renderConfigFields(type) {
            const template = configTemplates[type];
            if (!template) return;

            const html = template.fields.map(field => {
                if (field.type === 'select') {
                    return `
                        <div class="form-group">
                            <label>${field.label}</label>
                            <select name="${field.name}">
                                ${field.options.map(opt => `<option>${opt}</option>`).join('')}
                            </select>
                        </div>
                    `;
                } else if (field.type === 'checkbox') {
                    return `
                        <div class="form-group">
                            <label style="display: flex; align-items: center; gap: 10px;">
                                <input type="checkbox" name="${field.name}" style="width: auto;">
                                <span>${field.label}</span>
                            </label>
                        </div>
                    `;
                } else if (field.type === 'textarea') {
                    return `
                        <div class="form-group">
                            <label>${field.label}</label>
                            <textarea name="${field.name}" placeholder="${field.placeholder}" rows="4"></textarea>
                        </div>
                    `;
                } else {
                    return `
                        <div class="form-group">
                            <label>${field.label}</label>
                            <input type="${field.type}" name="${field.name}" placeholder="${field.placeholder}">
                        </div>
                    `;
                }
            }).join('');

            document.getElementById('configFields').innerHTML = html;
        }

        // ç¼–è¾‘è¿æ¥å™¨
        function editConnector(id) {
            const conn = connectors.find(c => c.id === id);
            if (!conn) return;

            currentConnectorType = conn.type;
            const icons = { email: 'ğŸ“§', git: 'ğŸ”€', http: 'ğŸŒ', database: 'ğŸ—„ï¸', cloud: 'â˜ï¸', notes: 'ğŸ“' };

            document.getElementById('modalIcon').textContent = icons[conn.type];
            document.getElementById('modalTitle').innerHTML = `${icons[conn.type]} ç¼–è¾‘ ${conn.name}`;
            document.getElementById('connectorName').value = conn.name;
            document.getElementById('testResultContainer').style.display = 'none';

            renderConfigFields(conn.type);
            document.getElementById('connectorModal').classList.add('show');
        }

        // æµ‹è¯•è¿æ¥
        function testConnection() {
            const container = document.getElementById('testResultContainer');
            const result = document.getElementById('testResult');

            container.style.display = 'block';
            result.className = 'test-result';
            result.innerHTML = 'ğŸ” æ­£åœ¨æµ‹è¯•è¿æ¥...';

            setTimeout(() => {
                const success = Math.random() > 0.3;
                if (success) {
                    result.className = 'test-result success';
                    result.innerHTML = 'âœ… è¿æ¥æµ‹è¯•æˆåŠŸ!';
                } else {
                    result.className = 'test-result error';
                    result.innerHTML = 'âŒ è¿æ¥å¤±è´¥: æ— æ³•è¿æ¥åˆ°æœåŠ¡å™¨ï¼Œè¯·æ£€æŸ¥é…ç½®';
                }
            }, 1500);
        }

        // æµ‹è¯•ç°æœ‰è¿æ¥å™¨
        function testConnector(id) {
            Utils.showToast('æ­£åœ¨æµ‹è¯•è¿æ¥...', 'info');
            setTimeout(() => {
                Utils.showToast('è¿æ¥æµ‹è¯•æˆåŠŸ', 'success');
            }, 1000);
        }

        // ä¿å­˜è¿æ¥å™¨
        function saveConnector() {
            const name = document.getElementById('connectorName').value;
            if (!name) {
                Utils.showToast('è¯·è¾“å…¥è¿æ¥å™¨åç§°', 'warning');
                return;
            }

            Utils.showToast('è¿æ¥å™¨å·²ä¿å­˜', 'success');
            closeModal();
        }

        // åˆ é™¤è¿æ¥å™¨
        function deleteConnector(id) {
            if (confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªè¿æ¥å™¨å—?')) {
                const index = connectors.findIndex(c => c.id === id);
                if (index !== -1) {
                    connectors.splice(index, 1);
                    renderConnectors();
                    Utils.showToast('è¿æ¥å™¨å·²åˆ é™¤', 'success');
                }
            }
        }

        // å¯¼å…¥è¿æ¥å™¨
        function importConnector() {
            Utils.showToast('å¯¼å…¥åŠŸèƒ½å¼€å‘ä¸­...', 'info');
        }

        // å…³é—­æ¨¡æ€æ¡†
        function closeModal() {
            document.getElementById('connectorModal').classList.remove('show');
        }

        // åˆå§‹åŒ–
        renderConnectors();
    </script>
</body>
</html>
