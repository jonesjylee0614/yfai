<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¿è¡Œè®°å½• - AI æ§åˆ¶å°</title>
    <link rel="stylesheet" href="assets/common.css">
    <style>
        body {
            margin: 0;
            padding: 0;
            background: var(--bg-darker);
            color: var(--text-primary);
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
        }

        .container {
            display: flex;
            height: 100vh;
        }

        /* ä¾§è¾¹æ  */
        .sidebar {
            width: 240px;
            background: var(--bg-dark);
            border-right: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
        }

        .sidebar-header {
            padding: 20px;
            border-bottom: 1px solid var(--border-color);
        }

        .sidebar-header h2 {
            margin: 0 0 10px 0;
            font-size: 18px;
            color: var(--text-primary);
        }

        .nav-item {
            padding: 12px 20px;
            cursor: pointer;
            transition: all 0.2s;
            border-left: 3px solid transparent;
        }

        .nav-item:hover {
            background: var(--bg-light);
        }

        .nav-item.active {
            background: var(--bg-light);
            border-left-color: var(--primary-color);
            color: var(--primary-color);
        }

        /* ä¸»å†…å®¹åŒº */
        .main-content {
            flex: 1;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .header {
            background: var(--bg-dark);
            border-bottom: 1px solid var(--border-color);
            padding: 20px 30px;
        }

        .header h1 {
            margin: 0;
            font-size: 24px;
            color: var(--text-primary);
        }

        .content-area {
            flex: 1;
            overflow-y: auto;
            padding: 30px;
        }

        /* ç»Ÿè®¡å¡ç‰‡ */
        .stats-cards {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: var(--bg-dark);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 20px;
        }

        .stat-value {
            font-size: 28px;
            font-weight: 700;
            margin: 10px 0;
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 13px;
        }

        /* è¿‡æ»¤å™¨ */
        .filters {
            background: var(--bg-dark);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }

        .filter-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .filter-group label {
            color: var(--text-secondary);
            font-size: 14px;
        }

        /* Job åˆ—è¡¨ */
        .jobs-list {
            background: var(--bg-dark);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            overflow: hidden;
        }

        .job-item {
            padding: 20px;
            border-bottom: 1px solid var(--border-color);
            cursor: pointer;
            transition: all 0.2s;
        }

        .job-item:hover {
            background: var(--bg-light);
        }

        .job-item:last-child {
            border-bottom: none;
        }

        .job-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 12px;
        }

        .job-icon {
            font-size: 24px;
        }

        .job-info {
            flex: 1;
            min-width: 0;
        }

        .job-name {
            font-size: 16px;
            font-weight: 600;
            margin: 0 0 6px 0;
        }

        .job-meta {
            display: flex;
            gap: 20px;
            font-size: 13px;
            color: var(--text-secondary);
        }

        .meta-item {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .job-status {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .status-badge {
            padding: 6px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }

        .status-badge.success {
            background: rgba(82, 196, 26, 0.1);
            color: var(--success-color);
            border: 1px solid var(--success-color);
        }

        .status-badge.running {
            background: rgba(24, 144, 255, 0.1);
            color: var(--primary-color);
            border: 1px solid var(--primary-color);
            animation: pulse 2s ease-in-out infinite;
        }

        .status-badge.failed {
            background: rgba(255, 77, 79, 0.1);
            color: var(--danger-color);
            border: 1px solid var(--danger-color);
        }

        .status-badge.pending {
            background: rgba(250, 173, 20, 0.1);
            color: var(--warning-color);
            border: 1px solid var(--warning-color);
        }

        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.5;
            }
        }

        .duration {
            color: var(--text-secondary);
            font-size: 13px;
        }

        /* æ¨¡æ€æ¡† - Jobè¯¦æƒ… */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.7);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: var(--bg-dark);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            width: 90%;
            max-width: 1000px;
            max-height: 90vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .modal-header {
            padding: 20px 30px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h2 {
            margin: 0;
            font-size: 20px;
        }

        .modal-body {
            padding: 30px;
            overflow-y: auto;
        }

        .job-detail-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            padding: 20px;
            background: var(--bg-darker);
            border-radius: 8px;
            margin-bottom: 25px;
        }

        .job-detail-info {
            flex: 1;
        }

        .job-detail-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 12px;
        }

        .job-detail-meta {
            display: flex;
            gap: 25px;
            font-size: 14px;
            color: var(--text-secondary);
        }

        .job-detail-actions {
            display: flex;
            gap: 10px;
        }

        /* æ­¥éª¤æ—¶é—´çº¿ */
        .steps-timeline {
            position: relative;
        }

        .timeline-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .timeline-header h3 {
            margin: 0;
            font-size: 18px;
        }

        .step-item {
            position: relative;
            padding-left: 50px;
            padding-bottom: 30px;
        }

        .step-item:last-child {
            padding-bottom: 0;
        }

        .step-item::before {
            content: '';
            position: absolute;
            left: 19px;
            top: 35px;
            bottom: -10px;
            width: 2px;
            background: var(--border-color);
        }

        .step-item:last-child::before {
            display: none;
        }

        .step-number {
            position: absolute;
            left: 0;
            top: 0;
            width: 38px;
            height: 38px;
            background: var(--bg-dark);
            border: 2px solid var(--border-color);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 14px;
        }

        .step-item.success .step-number {
            background: var(--success-color);
            border-color: var(--success-color);
            color: white;
        }

        .step-item.running .step-number {
            background: var(--primary-color);
            border-color: var(--primary-color);
            color: white;
            animation: pulse 2s ease-in-out infinite;
        }

        .step-item.failed .step-number {
            background: var(--danger-color);
            border-color: var(--danger-color);
            color: white;
        }

        .step-content {
            background: var(--bg-darker);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 15px;
        }

        .step-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .step-name {
            font-weight: 600;
            font-size: 15px;
        }

        .step-duration {
            color: var(--text-secondary);
            font-size: 13px;
        }

        .step-type {
            display: inline-block;
            padding: 3px 8px;
            background: var(--bg-light);
            border-radius: 4px;
            font-size: 11px;
            color: var(--text-secondary);
            margin-bottom: 10px;
        }

        .step-details {
            font-size: 13px;
            color: var(--text-secondary);
            line-height: 1.6;
        }

        .step-actions {
            display: flex;
            gap: 8px;
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid var(--border-color);
        }

        .expandable-section {
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid var(--border-color);
        }

        .expandable-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            padding: 8px;
            background: var(--bg-dark);
            border-radius: 4px;
        }

        .expandable-header:hover {
            background: var(--bg-light);
        }

        .expandable-content {
            display: none;
            margin-top: 10px;
            padding: 12px;
            background: var(--bg-dark);
            border-radius: 4px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 12px;
            overflow-x: auto;
        }

        .expandable-content.show {
            display: block;
        }

        .code-block {
            background: var(--bg-darker);
            padding: 12px;
            border-radius: 4px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 12px;
            overflow-x: auto;
            color: var(--text-primary);
        }

        .modal-footer {
            padding: 20px 30px;
            border-top: 1px solid var(--border-color);
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        .close-btn {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 24px;
            cursor: pointer;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 4px;
            transition: all 0.2s;
        }

        .close-btn:hover {
            background: var(--bg-light);
            color: var(--text-primary);
        }

        .type-badge {
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            background: var(--bg-darker);
            border: 1px solid var(--border-color);
        }

        .type-badge.agent {
            background: rgba(24, 144, 255, 0.1);
            border-color: var(--primary-color);
            color: var(--primary-color);
        }

        .type-badge.automation {
            background: rgba(82, 196, 26, 0.1);
            border-color: var(--success-color);
            color: var(--success-color);
        }

        .type-badge.manual {
            background: rgba(250, 173, 20, 0.1);
            border-color: var(--warning-color);
            color: var(--warning-color);
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- ä¾§è¾¹æ  -->
        <div class="sidebar">
            <div class="sidebar-header">
                <h2>ğŸ  AI æ§åˆ¶å°</h2>
                <div style="font-size: 12px; color: var(--text-secondary);">è¿è¡Œè§‚æµ‹å°</div>
            </div>
            <div class="nav-item" onclick="window.location.href='agents-center.html'">ğŸ¤– æ™ºèƒ½ä½“ä¸­å¿ƒ</div>
            <div class="nav-item" onclick="window.location.href='index.html'">ğŸ’¬ å¯¹è¯</div>
            <div class="nav-item" onclick="window.location.href='assistants.html'">ğŸ¯ åŠ©æ‰‹</div>
            <div class="nav-item" onclick="window.location.href='automation.html'">âš¡ è‡ªåŠ¨åŒ–</div>
            <div class="nav-item active">ğŸ“Š è¿è¡Œè®°å½•</div>
            <div class="nav-item" onclick="window.location.href='knowledge.html'">ğŸ“š çŸ¥è¯†åº“</div>
            <div class="nav-item" onclick="window.location.href='connectors.html'">ğŸ”Œ è¿æ¥å™¨</div>
            <div class="nav-item" onclick="window.location.href='sessions.html'">ğŸ“– ä¼šè¯</div>
            <div class="nav-item" onclick="window.location.href='logs.html'">ğŸ“‹ æ—¥å¿—</div>
            <div class="nav-item" onclick="window.location.href='settings.html'">âš™ï¸ è®¾ç½®</div>
        </div>

        <!-- ä¸»å†…å®¹åŒº -->
        <div class="main-content">
            <div class="header">
                <h1>ğŸ“Š è¿è¡Œè®°å½•</h1>
                <div style="color: var(--text-secondary); margin-top: 5px; font-size: 14px;">
                    æŸ¥çœ‹å’Œç®¡ç†æ™ºèƒ½ä½“ä¸è‡ªåŠ¨åŒ–ä»»åŠ¡çš„æ‰§è¡Œå†å²
                </div>
            </div>

            <div class="content-area">
                <!-- ç»Ÿè®¡å¡ç‰‡ -->
                <div class="stats-cards">
                    <div class="stat-card">
                        <div class="stat-label">æ€»è¿è¡Œæ¬¡æ•°</div>
                        <div class="stat-value">156</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">æˆåŠŸ</div>
                        <div class="stat-value" style="color: var(--success-color)">142</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">å¤±è´¥</div>
                        <div class="stat-value" style="color: var(--danger-color)">8</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">è¿è¡Œä¸­</div>
                        <div class="stat-value" style="color: var(--primary-color)">2</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">å¹³å‡è€—æ—¶</div>
                        <div class="stat-value" style="font-size: 24px;">12.5s</div>
                    </div>
                </div>

                <!-- è¿‡æ»¤å™¨ -->
                <div class="filters">
                    <div class="filter-group">
                        <label>ç±»å‹:</label>
                        <select style="padding: 6px 12px; background: var(--bg-darker); border: 1px solid var(--border-color); border-radius: 4px; color: var(--text-primary);">
                            <option>å…¨éƒ¨</option>
                            <option>æ™ºèƒ½ä½“</option>
                            <option>è‡ªåŠ¨åŒ–ä»»åŠ¡</option>
                            <option>æ‰‹åŠ¨æ‰§è¡Œ</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>çŠ¶æ€:</label>
                        <select style="padding: 6px 12px; background: var(--bg-darker); border: 1px solid var(--border-color); border-radius: 4px; color: var(--text-primary);">
                            <option>å…¨éƒ¨</option>
                            <option>æˆåŠŸ</option>
                            <option>å¤±è´¥</option>
                            <option>è¿è¡Œä¸­</option>
                            <option>å¾…æ‰§è¡Œ</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>æ—¶é—´èŒƒå›´:</label>
                        <select style="padding: 6px 12px; background: var(--bg-darker); border: 1px solid var(--border-color); border-radius: 4px; color: var(--text-primary);">
                            <option>ä»Šå¤©</option>
                            <option>æœ€è¿‘7å¤©</option>
                            <option>æœ€è¿‘30å¤©</option>
                            <option>å…¨éƒ¨</option>
                        </select>
                    </div>
                    <div class="filter-group" style="margin-left: auto;">
                        <input type="text" placeholder="æœç´¢ä»»åŠ¡..." style="padding: 6px 12px; width: 250px; background: var(--bg-darker); border: 1px solid var(--border-color); border-radius: 4px; color: var(--text-primary);">
                    </div>
                </div>

                <!-- Job åˆ—è¡¨ -->
                <div class="jobs-list" id="jobsList">
                    <!-- Job é¡¹å°†ç”± JS ç”Ÿæˆ -->
                </div>
            </div>
        </div>
    </div>

    <!-- Job è¯¦æƒ…æ¨¡æ€æ¡† -->
    <div class="modal" id="jobModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>è¿è¡Œè¯¦æƒ…</h2>
                <button class="close-btn" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body" id="jobDetailBody">
                <!-- å†…å®¹å°†ç”± JS ç”Ÿæˆ -->
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal()">å…³é—­</button>
            </div>
        </div>
    </div>

    <script src="assets/common.js"></script>
    <script>
        // ç¤ºä¾‹æ•°æ®
        const jobs = [
            {
                id: 'job-1',
                name: 'ç³»ç»Ÿå·¡æ£€ - å®šæ—¶ä»»åŠ¡',
                icon: 'ğŸ”',
                type: 'automation',
                agent: 'ç³»ç»Ÿå·¡æ£€åŠ©æ‰‹',
                status: 'running',
                startedAt: '2025-11-13 14:30:00',
                endedAt: null,
                duration: null,
                steps: [
                    { number: 1, name: 'åˆ†æä»»åŠ¡éœ€æ±‚', type: 'LLMè°ƒç”¨', status: 'success', duration: '1.2s', request: 'Analyze system check task', response: 'Task decomposed into 6 steps' },
                    { number: 2, name: 'æ£€æŸ¥ CPU ä½¿ç”¨ç‡', type: 'ProcessOps', status: 'success', duration: '0.3s', request: 'ps aux | grep cpu', response: 'CPU: 45%' },
                    { number: 3, name: 'æ£€æŸ¥å†…å­˜ä½¿ç”¨', type: 'ProcessOps', status: 'success', duration: '0.2s', request: 'free -h', response: 'Memory: 8.2GB / 16GB' },
                    { number: 4, name: 'æ£€æŸ¥ç£ç›˜ç©ºé—´', type: 'FsOps', status: 'success', duration: '0.4s', request: 'df -h', response: 'Disk: 120GB / 500GB' },
                    { number: 5, name: 'ç”Ÿæˆå·¡æ£€æŠ¥å‘Š', type: 'LLMè°ƒç”¨', status: 'running', duration: '-', request: 'Generate system report', response: null },
                    { number: 6, name: 'ä¿å­˜æŠ¥å‘Šæ–‡ä»¶', type: 'FsOps', status: 'pending', duration: '-', request: null, response: null }
                ]
            },
            {
                id: 'job-2',
                name: 'æ–‡æ¡£ç´¢å¼•æ›´æ–°',
                icon: 'ğŸ“š',
                type: 'automation',
                agent: 'çŸ¥è¯†æ•´ç†åŠ©æ‰‹',
                status: 'success',
                startedAt: '2025-11-13 14:15:00',
                endedAt: '2025-11-13 14:16:30',
                duration: '90s',
                steps: [
                    { number: 1, name: 'æ‰«ææ–‡æ¡£ç›®å½•', type: 'FsOps', status: 'success', duration: '2.1s' },
                    { number: 2, name: 'å‘ç°æ–°å¢æ–‡æ¡£', type: 'FsOps', status: 'success', duration: '0.5s' },
                    { number: 3, name: 'è¯»å–æ–‡æ¡£å†…å®¹', type: 'FsOps', status: 'success', duration: '1.8s' },
                    { number: 4, name: 'æ–‡æ¡£åˆ†å—å¤„ç†', type: 'VectorIndexer', status: 'success', duration: '15.2s' },
                    { number: 5, name: 'ç”Ÿæˆå‘é‡åµŒå…¥', type: 'BailianChat', status: 'success', duration: '45.3s' },
                    { number: 6, name: 'æ›´æ–°å‘é‡ç´¢å¼•', type: 'VectorIndexer', status: 'success', duration: '25.1s' }
                ]
            },
            {
                id: 'job-3',
                name: 'ä»£ç æ„å»ºæµ‹è¯•',
                icon: 'âš™ï¸',
                type: 'agent',
                agent: 'DevOps åŠ©æ‰‹',
                status: 'success',
                startedAt: '2025-11-13 13:45:00',
                endedAt: '2025-11-13 13:52:15',
                duration: '7m 15s',
                steps: [
                    { number: 1, name: 'æ‹‰å–æœ€æ–°ä»£ç ', type: 'GitOps', status: 'success', duration: '3.2s' },
                    { number: 2, name: 'å®‰è£…ä¾èµ–', type: 'ShellOps', status: 'success', duration: '45.8s' },
                    { number: 3, name: 'æ‰§è¡Œæ„å»º', type: 'ShellOps', status: 'success', duration: '3m 12s' },
                    { number: 4, name: 'è¿è¡Œå•å…ƒæµ‹è¯•', type: 'ShellOps', status: 'success', duration: '2m 15s' },
                    { number: 5, name: 'ç”Ÿæˆæµ‹è¯•æŠ¥å‘Š', type: 'FsOps', status: 'success', duration: '1.8s' }
                ]
            },
            {
                id: 'job-4',
                name: 'æ€§èƒ½æŠ¥å‘Šç”Ÿæˆ',
                icon: 'ğŸ“Š',
                type: 'automation',
                agent: 'ç³»ç»Ÿå·¡æ£€åŠ©æ‰‹',
                status: 'failed',
                startedAt: '2025-11-13 10:00:00',
                endedAt: '2025-11-13 10:02:15',
                duration: '2m 15s',
                steps: [
                    { number: 1, name: 'æ”¶é›†æ€§èƒ½æ•°æ®', type: 'ProcessOps', status: 'success', duration: '5.2s' },
                    { number: 2, name: 'åˆ†ææ•°æ®è¶‹åŠ¿', type: 'LLMè°ƒç”¨', status: 'success', duration: '15.8s' },
                    { number: 3, name: 'ç”Ÿæˆå›¾è¡¨', type: 'ShellOps', status: 'failed', duration: '1m 54s', error: 'matplotlib not found' }
                ]
            },
            {
                id: 'job-5',
                name: 'æ•°æ®åº“å¤‡ä»½',
                icon: 'ğŸ’¾',
                type: 'automation',
                agent: null,
                status: 'success',
                startedAt: '2025-11-13 09:00:00',
                endedAt: '2025-11-13 09:05:30',
                duration: '5m 30s',
                steps: [
                    { number: 1, name: 'è¿æ¥æ•°æ®åº“', type: 'DatabaseConnector', status: 'success', duration: '0.8s' },
                    { number: 2, name: 'å¯¼å‡ºæ•°æ®', type: 'DatabaseConnector', status: 'success', duration: '4m 20s' },
                    { number: 3, name: 'å‹ç¼©å¤‡ä»½æ–‡ä»¶', type: 'ShellOps', status: 'success', duration: '45s' },
                    { number: 4, name: 'ä¿å­˜åˆ°å¤‡ä»½ç›®å½•', type: 'FsOps', status: 'success', duration: '2.5s' }
                ]
            },
            {
                id: 'job-6',
                name: 'æ—¥å¿—åˆ†æ',
                icon: 'ğŸ“',
                type: 'manual',
                agent: 'DevOps åŠ©æ‰‹',
                status: 'success',
                startedAt: '2025-11-13 08:30:00',
                endedAt: '2025-11-13 08:33:20',
                duration: '3m 20s',
                steps: [
                    { number: 1, name: 'è¯»å–æ—¥å¿—æ–‡ä»¶', type: 'FsOps', status: 'success', duration: '2.1s' },
                    { number: 2, name: 'è§£ææ—¥å¿—å†…å®¹', type: 'ShellOps', status: 'success', duration: '15.8s' },
                    { number: 3, name: 'æå–é”™è¯¯ä¿¡æ¯', type: 'LLMè°ƒç”¨', status: 'success', duration: '2m 45s' },
                    { number: 4, name: 'ç”Ÿæˆåˆ†ææŠ¥å‘Š', type: 'LLMè°ƒç”¨', status: 'success', duration: '15.1s' }
                ]
            }
        ];

        // æ¸²æŸ“ Job åˆ—è¡¨
        function renderJobs() {
            const list = document.getElementById('jobsList');
            list.innerHTML = jobs.map(job => `
                <div class="job-item" onclick="showJobDetail('${job.id}')">
                    <div class="job-header">
                        <div class="job-icon">${job.icon}</div>
                        <div class="job-info">
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <h3 class="job-name">${job.name}</h3>
                                <span class="type-badge ${job.type}">${getTypeLabel(job.type)}</span>
                            </div>
                            <div class="job-meta">
                                <div class="meta-item">
                                    <span>ğŸ•</span>
                                    <span>${job.startedAt}</span>
                                </div>
                                ${job.agent ? `
                                <div class="meta-item">
                                    <span>ğŸ¤–</span>
                                    <span>${job.agent}</span>
                                </div>
                                ` : ''}
                                <div class="meta-item">
                                    <span>ğŸ“Š</span>
                                    <span>${job.steps.length} ä¸ªæ­¥éª¤</span>
                                </div>
                            </div>
                        </div>
                        <div class="job-status">
                            <span class="duration">${job.duration || 'è¿è¡Œä¸­...'}</span>
                            <span class="status-badge ${job.status}">${getStatusLabel(job.status)}</span>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function getTypeLabel(type) {
            const labels = {
                'agent': 'æ™ºèƒ½ä½“',
                'automation': 'è‡ªåŠ¨åŒ–',
                'manual': 'æ‰‹åŠ¨'
            };
            return labels[type] || type;
        }

        function getStatusLabel(status) {
            const labels = {
                'success': 'âœ… æˆåŠŸ',
                'running': 'â–¶ï¸ è¿è¡Œä¸­',
                'failed': 'âŒ å¤±è´¥',
                'pending': 'â¸ å¾…æ‰§è¡Œ'
            };
            return labels[status] || status;
        }

        // æ˜¾ç¤º Job è¯¦æƒ…
        function showJobDetail(jobId) {
            const job = jobs.find(j => j.id === jobId);
            if (!job) return;

            const detailHtml = `
                <div class="job-detail-header">
                    <div class="job-detail-info">
                        <div class="job-detail-title">${job.icon} ${job.name}</div>
                        <div class="job-detail-meta">
                            <div class="meta-item">
                                <span>ç±»å‹:</span> <span class="type-badge ${job.type}">${getTypeLabel(job.type)}</span>
                            </div>
                            ${job.agent ? `
                            <div class="meta-item">
                                <span>æ™ºèƒ½ä½“:</span> <span>${job.agent}</span>
                            </div>
                            ` : ''}
                            <div class="meta-item">
                                <span>å¼€å§‹æ—¶é—´:</span> <span>${job.startedAt}</span>
                            </div>
                            ${job.endedAt ? `
                            <div class="meta-item">
                                <span>ç»“æŸæ—¶é—´:</span> <span>${job.endedAt}</span>
                            </div>
                            ` : ''}
                            <div class="meta-item">
                                <span>è€—æ—¶:</span> <span>${job.duration || 'è¿è¡Œä¸­...'}</span>
                            </div>
                            <div class="meta-item">
                                <span>çŠ¶æ€:</span> <span class="status-badge ${job.status}">${getStatusLabel(job.status)}</span>
                            </div>
                        </div>
                    </div>
                    <div class="job-detail-actions">
                        <button class="btn btn-sm btn-primary" onclick="rerunJob('${job.id}')">
                            ğŸ”„ é‡æ–°è¿è¡Œ
                        </button>
                        <button class="btn btn-sm btn-secondary" onclick="exportJob('${job.id}')">
                            ğŸ“¥ å¯¼å‡º
                        </button>
                    </div>
                </div>

                <div class="steps-timeline">
                    <div class="timeline-header">
                        <h3>æ‰§è¡Œæ­¥éª¤</h3>
                        <div style="color: var(--text-secondary); font-size: 14px;">
                            ${job.steps.filter(s => s.status === 'success').length} / ${job.steps.length} å®Œæˆ
                        </div>
                    </div>

                    ${job.steps.map(step => `
                        <div class="step-item ${step.status}">
                            <div class="step-number">${step.number}</div>
                            <div class="step-content">
                                <div class="step-header">
                                    <div>
                                        <div class="step-name">${step.name}</div>
                                        <span class="step-type">${step.type}</span>
                                    </div>
                                    <div class="step-duration">${step.duration}</div>
                                </div>

                                ${step.error ? `
                                    <div style="color: var(--danger-color); padding: 10px; background: rgba(255,77,79,0.1); border-radius: 4px; margin-top: 10px;">
                                        âŒ é”™è¯¯: ${step.error}
                                    </div>
                                ` : ''}

                                ${step.request ? `
                                    <div class="expandable-section">
                                        <div class="expandable-header" onclick="toggleExpand(this)">
                                            <span>ğŸ“¤ è¯·æ±‚å‚æ•°</span>
                                            <span>â–¼</span>
                                        </div>
                                        <div class="expandable-content">
                                            <div class="code-block">${step.request}</div>
                                        </div>
                                    </div>
                                ` : ''}

                                ${step.response ? `
                                    <div class="expandable-section">
                                        <div class="expandable-header" onclick="toggleExpand(this)">
                                            <span>ğŸ“¥ æ‰§è¡Œç»“æœ</span>
                                            <span>â–¼</span>
                                        </div>
                                        <div class="expandable-content">
                                            <div class="code-block">${step.response}</div>
                                        </div>
                                    </div>
                                ` : ''}

                                ${step.status === 'success' || step.status === 'failed' ? `
                                    <div class="step-actions">
                                        <button class="btn btn-sm btn-secondary" onclick="rerunStep('${job.id}', ${step.number})">
                                            ğŸ”„ é‡è·‘æ­¤æ­¥
                                        </button>
                                        <button class="btn btn-sm btn-secondary" onclick="continueFrom('${job.id}', ${step.number})">
                                            â­ ä»æ­¤æ­¥ç»§ç»­
                                        </button>
                                    </div>
                                ` : ''}
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;

            document.getElementById('jobDetailBody').innerHTML = detailHtml;
            document.getElementById('jobModal').classList.add('show');
        }

        // å±•å¼€/æŠ˜å 
        function toggleExpand(header) {
            const content = header.nextElementSibling;
            const arrow = header.querySelector('span:last-child');
            content.classList.toggle('show');
            arrow.textContent = content.classList.contains('show') ? 'â–²' : 'â–¼';
        }

        // é‡æ–°è¿è¡Œ Job
        function rerunJob(jobId) {
            Utils.showToast('æ­£åœ¨é‡æ–°è¿è¡Œä»»åŠ¡...', 'info');
            setTimeout(() => {
                Utils.showToast('ä»»åŠ¡å·²é‡æ–°å¼€å§‹', 'success');
            }, 1000);
        }

        // é‡è·‘æŸä¸€æ­¥
        function rerunStep(jobId, stepNumber) {
            Utils.showToast(`æ­£åœ¨é‡è·‘æ­¥éª¤ ${stepNumber}...`, 'info');
        }

        // ä»æŸæ­¥ç»§ç»­
        function continueFrom(jobId, stepNumber) {
            Utils.showToast(`æ­£åœ¨ä»æ­¥éª¤ ${stepNumber} ç»§ç»­æ‰§è¡Œ...`, 'info');
        }

        // å¯¼å‡º Job
        function exportJob(jobId) {
            Utils.showToast('å¯¼å‡ºåŠŸèƒ½å¼€å‘ä¸­...', 'info');
        }

        // å…³é—­æ¨¡æ€æ¡†
        function closeModal() {
            document.getElementById('jobModal').classList.remove('show');
        }

        // åˆå§‹åŒ–
        renderJobs();
    </script>
</body>
</html>
