<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ—¥å¿—ä¸å®¡è®¡</title>
    <link rel="stylesheet" href="assets/common.css">
    <style>
        body {
            display: flex;
            height: 100vh;
            overflow: hidden;
        }

        /* ä¾§è¾¹æ  */
        .sidebar {
            width: 60px;
            background: var(--bg-darker);
            border-right: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 12px 0;
            transition: width 0.3s;
        }

        .sidebar:hover {
            width: 200px;
        }

        .sidebar-item {
            width: 100%;
            padding: 12px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            color: var(--text-secondary);
            text-decoration: none;
            white-space: nowrap;
        }

        .sidebar-item:hover {
            background: var(--bg-light);
            color: var(--text-primary);
        }

        .sidebar-item.active {
            background: var(--bg-light);
            color: var(--primary-color);
            border-left: 3px solid var(--primary-color);
        }

        .sidebar-icon {
            width: 24px;
            height: 24px;
            margin: 0 auto;
            font-size: 20px;
        }

        .sidebar:hover .sidebar-icon {
            margin: 0 12px 0 0;
        }

        .sidebar-text {
            display: none;
            font-size: 14px;
        }

        .sidebar:hover .sidebar-text {
            display: inline;
        }

        /* ä¸»å†…å®¹åŒº */
        .main-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* é¡¶éƒ¨æ  */
        .header {
            height: 60px;
            background: var(--bg-dark);
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .page-title {
            font-size: 18px;
            font-weight: 600;
        }

        .header-actions {
            display: flex;
            gap: 8px;
        }

        /* å·¥å…·æ  */
        .toolbar {
            background: var(--bg-dark);
            border-bottom: 1px solid var(--border-color);
            padding: 12px 20px;
            display: flex;
            gap: 12px;
            align-items: center;
            flex-wrap: wrap;
        }

        .toolbar-group {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .toolbar-label {
            font-size: 13px;
            color: var(--text-secondary);
        }

        .filter-select {
            padding: 6px 12px;
            min-width: 120px;
        }

        .search-input {
            padding: 6px 12px;
            min-width: 200px;
        }

        /* æ—¥å¿—åˆ—è¡¨ */
        .logs-container {
            flex: 1;
            overflow-y: auto;
            padding: 16px;
        }

        .log-entry {
            background: var(--bg-light);
            border: 1px solid var(--border-color);
            border-radius: var(--radius);
            padding: 16px;
            margin-bottom: 12px;
            transition: all 0.3s;
            cursor: pointer;
        }

        .log-entry:hover {
            border-color: var(--primary-color);
            transform: translateX(4px);
        }

        .log-entry.expanded {
            border-color: var(--primary-color);
        }

        .log-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .log-title {
            display: flex;
            align-items: center;
            gap: 12px;
            font-weight: 600;
        }

        .log-icon {
            font-size: 20px;
        }

        .log-meta {
            display: flex;
            gap: 12px;
            font-size: 12px;
            color: var(--text-secondary);
        }

        .log-content {
            font-size: 13px;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }

        .log-details {
            display: none;
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid var(--border-color);
        }

        .log-entry.expanded .log-details {
            display: block;
        }

        .detail-row {
            display: flex;
            margin-bottom: 8px;
            font-size: 13px;
        }

        .detail-label {
            min-width: 120px;
            color: var(--text-secondary);
            font-weight: 600;
        }

        .detail-value {
            flex: 1;
            color: var(--text-primary);
            word-break: break-all;
        }

        .log-code {
            background: var(--bg-darker);
            border: 1px solid var(--border-color);
            border-radius: var(--radius);
            padding: 12px;
            margin: 8px 0;
            max-height: 200px;
            overflow-y: auto;
        }

        .log-code code {
            font-size: 12px;
            white-space: pre-wrap;
            word-break: break-all;
        }

        .log-actions {
            display: flex;
            gap: 8px;
            margin-top: 12px;
        }

        /* ç»Ÿè®¡å¡ç‰‡ */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: var(--bg-light);
            border: 1px solid var(--border-color);
            border-radius: var(--radius);
            padding: 16px;
            text-align: center;
        }

        .stat-value {
            font-size: 32px;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .stat-label {
            font-size: 13px;
            color: var(--text-secondary);
        }

        .stat-card.success .stat-value {
            color: var(--success-color);
        }

        .stat-card.warning .stat-value {
            color: var(--warning-color);
        }

        .stat-card.danger .stat-value {
            color: var(--danger-color);
        }

        /* ç©ºçŠ¶æ€ */
        .empty-state {
            text-align: center;
            padding: 80px 20px;
            color: var(--text-secondary);
        }

        .empty-icon {
            font-size: 64px;
            margin-bottom: 16px;
        }

        /* æ—¶é—´çº¿è§†å›¾ */
        .timeline {
            position: relative;
            padding-left: 40px;
        }

        .timeline::before {
            content: '';
            position: absolute;
            left: 15px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: var(--border-color);
        }

        .timeline-item {
            position: relative;
            margin-bottom: 24px;
        }

        .timeline-marker {
            position: absolute;
            left: -33px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--primary-color);
            border: 2px solid var(--bg-dark);
        }

        .timeline-time {
            font-size: 12px;
            color: var(--text-secondary);
            margin-bottom: 4px;
        }
    </style>
</head>
<body>
    <!-- å·¦ä¾§å¯¼èˆªæ  -->
    <div class="sidebar">
        <a href="index.html" class="sidebar-item">
            <span class="sidebar-icon">ğŸ’¬</span>
            <span class="sidebar-text">å¯¹è¯</span>
        </a>
        <a href="tools-sidebar.html" class="sidebar-item">
            <span class="sidebar-icon">ğŸ› ï¸</span>
            <span class="sidebar-text">å·¥å…·</span>
        </a>
        <a href="logs.html" class="sidebar-item active">
            <span class="sidebar-icon">ğŸ“‹</span>
            <span class="sidebar-text">æ—¥å¿—</span>
        </a>
        <a href="settings.html" class="sidebar-item">
            <span class="sidebar-icon">âš™ï¸</span>
            <span class="sidebar-text">è®¾ç½®</span>
        </a>
    </div>

    <!-- ä¸»å†…å®¹åŒº -->
    <div class="main-container">
        <!-- é¡¶éƒ¨æ  -->
        <div class="header">
            <div class="header-left">
                <div class="page-title">ğŸ“‹ æ—¥å¿—ä¸å®¡è®¡</div>
            </div>
            <div class="header-actions">
                <button class="btn btn-secondary btn-small" onclick="exportLogs()">ğŸ“¥ å¯¼å‡º</button>
                <button class="btn btn-secondary btn-small" onclick="clearLogs()">ğŸ—‘ï¸ æ¸…ç©º</button>
                <button class="btn btn-primary btn-small" onclick="refreshLogs()">ğŸ”„ åˆ·æ–°</button>
            </div>
        </div>

        <!-- å·¥å…·æ  -->
        <div class="toolbar">
            <div class="toolbar-group">
                <span class="toolbar-label">ç±»å‹ï¼š</span>
                <select class="filter-select" onchange="filterLogs('type', this.value)">
                    <option value="all">å…¨éƒ¨</option>
                    <option value="tool">å·¥å…·è°ƒç”¨</option>
                    <option value="approval">å®¡æ‰¹è®°å½•</option>
                    <option value="error">é”™è¯¯</option>
                    <option value="system">ç³»ç»Ÿ</option>
                </select>
            </div>

            <div class="toolbar-group">
                <span class="toolbar-label">é£é™©ï¼š</span>
                <select class="filter-select" onchange="filterLogs('risk', this.value)">
                    <option value="all">å…¨éƒ¨</option>
                    <option value="low">ä½å±</option>
                    <option value="medium">ä¸­å±</option>
                    <option value="high">é«˜å±</option>
                    <option value="critical">ä¸¥é‡</option>
                </select>
            </div>

            <div class="toolbar-group">
                <span class="toolbar-label">æ—¶é—´ï¼š</span>
                <select class="filter-select" onchange="filterLogs('time', this.value)">
                    <option value="all">å…¨éƒ¨</option>
                    <option value="today">ä»Šå¤©</option>
                    <option value="week">æœ¬å‘¨</option>
                    <option value="month">æœ¬æœˆ</option>
                </select>
            </div>

            <div class="toolbar-group" style="margin-left: auto;">
                <input 
                    type="text" 
                    class="search-input" 
                    placeholder="æœç´¢æ—¥å¿—..." 
                    oninput="searchLogs(this.value)"
                >
            </div>
        </div>

        <!-- æ—¥å¿—å†…å®¹ -->
        <div class="logs-container" id="logsContainer">
            <!-- ç»Ÿè®¡å¡ç‰‡ -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value">127</div>
                    <div class="stat-label">æ€»æ“ä½œæ•°</div>
                </div>
                <div class="stat-card success">
                    <div class="stat-value">115</div>
                    <div class="stat-label">æˆåŠŸ</div>
                </div>
                <div class="stat-card warning">
                    <div class="stat-value">8</div>
                    <div class="stat-label">éœ€å®¡æ‰¹</div>
                </div>
                <div class="stat-card danger">
                    <div class="stat-value">4</div>
                    <div class="stat-label">å¤±è´¥</div>
                </div>
            </div>

            <!-- æ—¥å¿—åˆ—è¡¨ -->
            <div id="logsList">
                <!-- æ—¥å¿—é¡¹ä¼šåŠ¨æ€æ’å…¥ -->
            </div>
        </div>
    </div>

    <script src="assets/common.js"></script>
    <script>
        // æ¨¡æ‹Ÿæ—¥å¿—æ•°æ®
        const logsData = [
            {
                id: 1,
                type: 'tool',
                icon: 'âš¡',
                title: 'PowerShell å‘½ä»¤æ‰§è¡Œ',
                content: 'Get-Process | Sort-Object CPU -Descending | Select-Object -First 10',
                risk: 'medium',
                status: 'success',
                timestamp: new Date('2025-11-12 22:55:00'),
                source: 'LLM',
                duration: '2.3s',
                output: 'ProcessName    CPU(s)\n-----------    ------\nchrome        45.23\nnode          23.45\n...',
                exitCode: 0
            },
            {
                id: 2,
                type: 'approval',
                icon: 'âœ…',
                title: 'æ–‡ä»¶åˆ é™¤æ“ä½œå·²æ‰¹å‡†',
                content: 'ç”¨æˆ·æ‰¹å‡†åˆ é™¤ D:\\temp\\*.log æ–‡ä»¶',
                risk: 'high',
                status: 'approved',
                timestamp: new Date('2025-11-12 22:45:00'),
                source: 'ç”¨æˆ·',
                approver: 'ç®¡ç†å‘˜',
                filesAffected: 15
            },
            {
                id: 3,
                type: 'tool',
                icon: 'ğŸ”§',
                title: 'MCP å·¥å…·è°ƒç”¨',
                content: 'fs.search - æœç´¢ Markdown æ–‡ä»¶',
                risk: 'low',
                status: 'success',
                timestamp: new Date('2025-11-12 22:30:00'),
                source: 'MCP',
                server: 'files',
                duration: '0.8s',
                results: 23
            },
            {
                id: 4,
                type: 'error',
                icon: 'âŒ',
                title: 'å·¥å…·è°ƒç”¨å¤±è´¥',
                content: 'shell.bash - å‘½ä»¤æ‰§è¡Œè¶…æ—¶',
                risk: 'medium',
                status: 'failed',
                timestamp: new Date('2025-11-12 22:15:00'),
                source: 'LLM',
                error: 'Timeout after 30 seconds',
                retryCount: 2
            },
            {
                id: 5,
                type: 'system',
                icon: 'ğŸ”„',
                title: 'MCP æœåŠ¡å™¨é‡å¯',
                content: 'devops MCP æœåŠ¡å™¨å·²é‡æ–°è¿æ¥',
                risk: 'low',
                status: 'success',
                timestamp: new Date('2025-11-12 22:00:00'),
                source: 'ç³»ç»Ÿ',
                server: 'devops'
            },
            {
                id: 6,
                type: 'tool',
                icon: 'ğŸ“',
                title: 'æ–‡ä»¶è¯»å–æ“ä½œ',
                content: 'fs.read - è¯»å–é…ç½®æ–‡ä»¶',
                risk: 'low',
                status: 'success',
                timestamp: new Date('2025-11-12 21:45:00'),
                source: 'ç”¨æˆ·',
                path: 'D:\\WorkSpace\\aipros\\yfai\\config.yaml',
                size: '2.3 KB'
            },
            {
                id: 7,
                type: 'approval',
                icon: 'âŒ',
                title: 'æ“ä½œè¢«æ‹’ç»',
                content: 'ç”¨æˆ·æ‹’ç»æ‰§è¡Œè¿›ç¨‹ç»ˆæ­¢æ“ä½œ',
                risk: 'critical',
                status: 'rejected',
                timestamp: new Date('2025-11-12 21:30:00'),
                source: 'ç”¨æˆ·',
                reason: 'é£é™©è¿‡é«˜ï¼Œéœ€è¿›ä¸€æ­¥ç¡®è®¤'
            }
        ];

        let filteredLogs = [...logsData];

        // åˆå§‹åŒ–
        window.onload = function() {
            renderLogs();
        };

        // æ¸²æŸ“æ—¥å¿—
        function renderLogs() {
            const container = document.getElementById('logsList');
            
            if (filteredLogs.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">ğŸ“‹</div>
                        <div>æš‚æ— æ—¥å¿—è®°å½•</div>
                    </div>
                `;
                return;
            }

            container.innerHTML = filteredLogs.map(log => `
                <div class="log-entry" onclick="toggleLogDetails(${log.id})">
                    <div class="log-header">
                        <div class="log-title">
                            <span class="log-icon">${log.icon}</span>
                            <span>${log.title}</span>
                            <span class="tag tag-${log.risk}">${getRiskText(log.risk)}</span>
                            ${getStatusBadge(log.status)}
                        </div>
                        <div class="log-meta">
                            <span>ğŸ“… ${Utils.formatTime(log.timestamp)}</span>
                            <span>ğŸ‘¤ ${log.source}</span>
                        </div>
                    </div>
                    <div class="log-content">${log.content}</div>
                    
                    <div class="log-details" id="details-${log.id}">
                        ${renderLogDetails(log)}
                        <div class="log-actions">
                            <button class="btn btn-secondary btn-small" onclick="event.stopPropagation(); copyLog(${log.id})">
                                ğŸ“‹ å¤åˆ¶
                            </button>
                            <button class="btn btn-secondary btn-small" onclick="event.stopPropagation(); viewFullLog(${log.id})">
                                ğŸ” æŸ¥çœ‹è¯¦æƒ…
                            </button>
                            ${log.type === 'tool' && log.status === 'success' ? `
                                <button class="btn btn-secondary btn-small" onclick="event.stopPropagation(); rerunTool(${log.id})">
                                    ğŸ”„ é‡æ–°è¿è¡Œ
                                </button>
                            ` : ''}
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // æ¸²æŸ“æ—¥å¿—è¯¦æƒ…
        function renderLogDetails(log) {
            let html = `
                <div class="detail-row">
                    <div class="detail-label">æ—¥å¿— IDï¼š</div>
                    <div class="detail-value">${log.id}</div>
                </div>
                <div class="detail-row">
                    <div class="detail-label">ç±»å‹ï¼š</div>
                    <div class="detail-value">${getTypeText(log.type)}</div>
                </div>
                <div class="detail-row">
                    <div class="detail-label">é£é™©ç­‰çº§ï¼š</div>
                    <div class="detail-value">${getRiskText(log.risk)}</div>
                </div>
                <div class="detail-row">
                    <div class="detail-label">çŠ¶æ€ï¼š</div>
                    <div class="detail-value">${getStatusText(log.status)}</div>
                </div>
            `;

            // æ ¹æ®ä¸åŒç±»å‹æ·»åŠ ç‰¹å®šå­—æ®µ
            if (log.duration) {
                html += `
                    <div class="detail-row">
                        <div class="detail-label">è€—æ—¶ï¼š</div>
                        <div class="detail-value">${log.duration}</div>
                    </div>
                `;
            }

            if (log.output) {
                html += `
                    <div class="detail-row">
                        <div class="detail-label">è¾“å‡ºï¼š</div>
                        <div class="detail-value">
                            <div class="log-code"><code>${log.output}</code></div>
                        </div>
                    </div>
                `;
            }

            if (log.error) {
                html += `
                    <div class="detail-row">
                        <div class="detail-label">é”™è¯¯ä¿¡æ¯ï¼š</div>
                        <div class="detail-value" style="color: var(--danger-color);">${log.error}</div>
                    </div>
                `;
            }

            return html;
        }

        // åˆ‡æ¢æ—¥å¿—è¯¦æƒ…
        function toggleLogDetails(id) {
            const entry = event.currentTarget;
            entry.classList.toggle('expanded');
        }

        // è¿‡æ»¤æ—¥å¿—
        function filterLogs(filterType, value) {
            // å®ç°è¿‡æ»¤é€»è¾‘
            Utils.showToast(`å·²åº”ç”¨è¿‡æ»¤: ${filterType} = ${value}`, 'info');
        }

        // æœç´¢æ—¥å¿—
        function searchLogs(query) {
            query = query.toLowerCase();
            if (!query) {
                filteredLogs = [...logsData];
            } else {
                filteredLogs = logsData.filter(log => 
                    log.title.toLowerCase().includes(query) ||
                    log.content.toLowerCase().includes(query)
                );
            }
            renderLogs();
        }

        // åˆ·æ–°æ—¥å¿—
        function refreshLogs() {
            Utils.showToast('æ­£åœ¨åˆ·æ–°æ—¥å¿—...', 'info');
            setTimeout(() => {
                renderLogs();
                Utils.showToast('æ—¥å¿—å·²æ›´æ–°', 'success');
            }, 500);
        }

        // å¯¼å‡ºæ—¥å¿—
        function exportLogs() {
            Utils.confirm('ç¡®å®šè¦å¯¼å‡ºæ—¥å¿—å—ï¼Ÿ', () => {
                Utils.showToast('æ­£åœ¨å¯¼å‡ºæ—¥å¿—ä¸º Markdown...', 'info');
                setTimeout(() => {
                    Utils.showToast('æ—¥å¿—å·²å¯¼å‡ºåˆ°ä¸‹è½½æ–‡ä»¶å¤¹', 'success');
                }, 1000);
            });
        }

        // æ¸…ç©ºæ—¥å¿—
        function clearLogs() {
            Utils.confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰æ—¥å¿—å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼', () => {
                filteredLogs = [];
                renderLogs();
                Utils.showToast('æ—¥å¿—å·²æ¸…ç©º', 'success');
            });
        }

        // å¤åˆ¶æ—¥å¿—
        function copyLog(id) {
            const log = logsData.find(l => l.id === id);
            if (log) {
                const text = `[${Utils.formatTime(log.timestamp)}] ${log.title}\n${log.content}`;
                Utils.copyToClipboard(text);
            }
        }

        // æŸ¥çœ‹å®Œæ•´æ—¥å¿—
        function viewFullLog(id) {
            Utils.showToast('æ—¥å¿—è¯¦æƒ…åŠŸèƒ½å¼€å‘ä¸­...', 'info');
        }

        // é‡æ–°è¿è¡Œå·¥å…·
        function rerunTool(id) {
            Utils.showToast('æ­£åœ¨é‡æ–°è¿è¡Œå·¥å…·...', 'info');
        }

        // è¾…åŠ©å‡½æ•°
        function getRiskText(risk) {
            const texts = {
                low: 'ä½å±',
                medium: 'ä¸­å±',
                high: 'é«˜å±',
                critical: 'ä¸¥é‡'
            };
            return texts[risk] || risk;
        }

        function getTypeText(type) {
            const texts = {
                tool: 'å·¥å…·è°ƒç”¨',
                approval: 'å®¡æ‰¹è®°å½•',
                error: 'é”™è¯¯',
                system: 'ç³»ç»Ÿ'
            };
            return texts[type] || type;
        }

        function getStatusText(status) {
            const texts = {
                success: 'æˆåŠŸ',
                failed: 'å¤±è´¥',
                approved: 'å·²æ‰¹å‡†',
                rejected: 'å·²æ‹’ç»',
                pending: 'ç­‰å¾…ä¸­'
            };
            return texts[status] || status;
        }

        function getStatusBadge(status) {
            const badges = {
                success: '<span class="tag tag-low">âœ“ æˆåŠŸ</span>',
                failed: '<span class="tag tag-high">âœ— å¤±è´¥</span>',
                approved: '<span class="tag tag-low">âœ“ å·²æ‰¹å‡†</span>',
                rejected: '<span class="tag tag-high">âœ— å·²æ‹’ç»</span>',
                pending: '<span class="tag tag-medium">â³ ç­‰å¾…ä¸­</span>'
            };
            return badges[status] || '';
        }
    </script>
</body>
</html>

