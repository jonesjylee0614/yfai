<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ™ºèƒ½ä½“ä¸­å¿ƒ - AI æ§åˆ¶å°</title>
    <link rel="stylesheet" href="assets/common.css">
    <style>
        body {
            margin: 0;
            padding: 0;
            background: var(--bg-darker);
            color: var(--text-primary);
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
        }

        .container {
            display: flex;
            height: 100vh;
        }

        /* ä¾§è¾¹æ  */
        .sidebar {
            width: 240px;
            background: var(--bg-dark);
            border-right: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
        }

        .sidebar-header {
            padding: 20px;
            border-bottom: 1px solid var(--border-color);
        }

        .sidebar-header h2 {
            margin: 0 0 10px 0;
            font-size: 18px;
            color: var(--text-primary);
        }

        .nav-item {
            padding: 12px 20px;
            cursor: pointer;
            transition: all 0.2s;
            border-left: 3px solid transparent;
        }

        .nav-item:hover {
            background: var(--bg-light);
        }

        .nav-item.active {
            background: var(--bg-light);
            border-left-color: var(--primary-color);
            color: var(--primary-color);
        }

        /* ä¸»å†…å®¹åŒº */
        .main-content {
            flex: 1;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .header {
            background: var(--bg-dark);
            border-bottom: 1px solid var(--border-color);
            padding: 20px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            margin: 0;
            font-size: 24px;
            color: var(--text-primary);
        }

        .header-actions {
            display: flex;
            gap: 10px;
        }

        .content-area {
            flex: 1;
            overflow-y: auto;
            padding: 30px;
        }

        /* æ™ºèƒ½ä½“å¡ç‰‡ */
        .agents-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .agent-card {
            background: var(--bg-dark);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 20px;
            transition: all 0.3s;
            position: relative;
        }

        .agent-card:hover {
            border-color: var(--primary-color);
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.3);
        }

        .agent-card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }

        .agent-icon {
            font-size: 32px;
            margin-right: 15px;
        }

        .agent-info {
            flex: 1;
        }

        .agent-name {
            font-size: 18px;
            font-weight: 600;
            margin: 0 0 8px 0;
            color: var(--text-primary);
        }

        .agent-description {
            color: var(--text-secondary);
            font-size: 14px;
            line-height: 1.5;
            margin-bottom: 15px;
        }

        .agent-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 15px;
        }

        .meta-item {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 12px;
            color: var(--text-secondary);
        }

        .agent-tools {
            margin-bottom: 15px;
        }

        .tools-label {
            font-size: 12px;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }

        .tools-list {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }

        .tool-tag {
            padding: 4px 8px;
            background: var(--bg-light);
            border: 1px solid var(--border-color);
            border-radius: 4px;
            font-size: 11px;
            color: var(--text-secondary);
        }

        .agent-actions {
            display: flex;
            gap: 10px;
            padding-top: 15px;
            border-top: 1px solid var(--border-color);
        }

        .toggle-switch {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 44px;
            height: 24px;
            background: var(--border-color);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .toggle-switch.active {
            background: var(--success-color);
        }

        .toggle-switch::after {
            content: '';
            position: absolute;
            top: 2px;
            left: 2px;
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            transition: all 0.3s;
        }

        .toggle-switch.active::after {
            left: 22px;
        }

        /* æ¨¡æ€æ¡† */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.7);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: var(--bg-dark);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .modal-header {
            padding: 20px 30px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h2 {
            margin: 0;
            font-size: 20px;
        }

        .modal-body {
            padding: 30px;
            overflow-y: auto;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: var(--text-primary);
            font-weight: 500;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 10px 12px;
            background: var(--bg-darker);
            border: 1px solid var(--border-color);
            border-radius: 4px;
            color: var(--text-primary);
            font-size: 14px;
        }

        .form-group textarea {
            min-height: 100px;
            resize: vertical;
            font-family: 'Consolas', 'Monaco', monospace;
        }

        .form-help {
            font-size: 12px;
            color: var(--text-secondary);
            margin-top: 5px;
        }

        .tools-selector {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 10px;
        }

        .tool-checkbox {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px;
            background: var(--bg-darker);
            border: 1px solid var(--border-color);
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .tool-checkbox:hover {
            background: var(--bg-light);
        }

        .tool-checkbox input[type="checkbox"] {
            width: auto;
        }

        .modal-footer {
            padding: 20px 30px;
            border-top: 1px solid var(--border-color);
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        /* æ‰§è¡Œè®¡åˆ’è§†å›¾ */
        .plan-steps {
            margin-top: 20px;
        }

        .step-item {
            background: var(--bg-light);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            padding: 15px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .step-number {
            width: 32px;
            height: 32px;
            background: var(--primary-color);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            flex-shrink: 0;
        }

        .step-item.completed .step-number {
            background: var(--success-color);
        }

        .step-item.failed .step-number {
            background: var(--danger-color);
        }

        .step-info {
            flex: 1;
        }

        .step-name {
            font-weight: 500;
            margin-bottom: 5px;
        }

        .step-details {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .step-actions {
            display: flex;
            gap: 8px;
        }

        .risk-badge {
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .risk-badge.low {
            background: rgba(82, 196, 26, 0.1);
            color: var(--success-color);
            border: 1px solid var(--success-color);
        }

        .risk-badge.medium {
            background: rgba(250, 173, 20, 0.1);
            color: var(--warning-color);
            border: 1px solid var(--warning-color);
        }

        .risk-badge.high {
            background: rgba(255, 77, 79, 0.1);
            color: var(--danger-color);
            border: 1px solid var(--danger-color);
        }

        .stats-row {
            display: flex;
            gap: 15px;
            margin-top: 10px;
            font-size: 12px;
            color: var(--text-secondary);
        }

        .stat-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .close-btn {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 24px;
            cursor: pointer;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 4px;
            transition: all 0.2s;
        }

        .close-btn:hover {
            background: var(--bg-light);
            color: var(--text-primary);
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- ä¾§è¾¹æ  -->
        <div class="sidebar">
            <div class="sidebar-header">
                <h2>ğŸ  AI æ§åˆ¶å°</h2>
                <div style="font-size: 12px; color: var(--text-secondary);">æ™ºèƒ½ä½“å·¥ä½œå°</div>
            </div>
            <div class="nav-item active">ğŸ¤– æ™ºèƒ½ä½“ä¸­å¿ƒ</div>
            <div class="nav-item" onclick="window.location.href='index.html'">ğŸ’¬ å¯¹è¯</div>
            <div class="nav-item" onclick="window.location.href='assistants.html'">ğŸ¯ åŠ©æ‰‹</div>
            <div class="nav-item" onclick="window.location.href='automation.html'">âš¡ è‡ªåŠ¨åŒ–</div>
            <div class="nav-item" onclick="window.location.href='jobs.html'">ğŸ“Š è¿è¡Œè®°å½•</div>
            <div class="nav-item" onclick="window.location.href='knowledge.html'">ğŸ“š çŸ¥è¯†åº“</div>
            <div class="nav-item" onclick="window.location.href='connectors.html'">ğŸ”Œ è¿æ¥å™¨</div>
            <div class="nav-item" onclick="window.location.href='sessions.html'">ğŸ“– ä¼šè¯</div>
            <div class="nav-item" onclick="window.location.href='logs.html'">ğŸ“‹ æ—¥å¿—</div>
            <div class="nav-item" onclick="window.location.href='settings.html'">âš™ï¸ è®¾ç½®</div>
        </div>

        <!-- ä¸»å†…å®¹åŒº -->
        <div class="main-content">
            <div class="header">
                <div>
                    <h1>ğŸ¤– æ™ºèƒ½ä½“ä¸­å¿ƒ</h1>
                    <div style="color: var(--text-secondary); margin-top: 5px; font-size: 14px;">
                        ç®¡ç†å¯è‡ªä¸»æ‰§è¡Œå¤šæ­¥ä»»åŠ¡çš„æ™ºèƒ½ä½“ Agent
                    </div>
                </div>
                <div class="header-actions">
                    <button class="btn btn-secondary" onclick="showTemplates()">
                        ğŸ“‘ ä»æ¨¡æ¿åˆ›å»º
                    </button>
                    <button class="btn btn-primary" onclick="createAgent()">
                        â• åˆ›å»ºæ™ºèƒ½ä½“
                    </button>
                </div>
            </div>

            <div class="content-area">
                <!-- æ™ºèƒ½ä½“åˆ—è¡¨ -->
                <div class="agents-grid" id="agentsGrid">
                    <!-- Agent å¡ç‰‡å°†ç”± JS åŠ¨æ€ç”Ÿæˆ -->
                </div>
            </div>
        </div>
    </div>

    <!-- åˆ›å»º/ç¼–è¾‘æ™ºèƒ½ä½“æ¨¡æ€æ¡† -->
    <div class="modal" id="agentModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">åˆ›å»ºæ™ºèƒ½ä½“</h2>
                <button class="close-btn" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="agentForm">
                    <div class="form-group">
                        <label>åç§° *</label>
                        <input type="text" id="agentName" placeholder="ä¾‹å¦‚ï¼šDevOps åŠ©æ‰‹" required>
                    </div>

                    <div class="form-group">
                        <label>æè¿°</label>
                        <textarea id="agentDescription" placeholder="æè¿°è¿™ä¸ªæ™ºèƒ½ä½“çš„åŠŸèƒ½å’Œç”¨é€”..."></textarea>
                    </div>

                    <div class="form-group">
                        <label>ç³»ç»Ÿæç¤ºè¯ *</label>
                        <textarea id="agentPrompt" rows="6" placeholder="ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„...&#10;ä½ çš„èŒè´£æ˜¯...&#10;ä½ å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å·¥å…·..."></textarea>
                        <div class="form-help">å®šä¹‰æ™ºèƒ½ä½“çš„è§’è‰²ã€èƒ½åŠ›å’Œè¡Œä¸ºè§„èŒƒ</div>
                    </div>

                    <div class="form-group">
                        <label>é»˜è®¤æ¨¡å‹</label>
                        <select id="agentModel">
                            <option value="qwen-max">é€šä¹‰åƒé—® Max</option>
                            <option value="qwen-plus">é€šä¹‰åƒé—® Plus</option>
                            <option value="qwen-turbo">é€šä¹‰åƒé—® Turbo</option>
                            <option value="llama3:70b">Llama 3 70B (æœ¬åœ°)</option>
                            <option value="llama3:8b">Llama 3 8B (æœ¬åœ°)</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>æœ€å¤§æ‰§è¡Œæ­¥æ•°</label>
                        <input type="number" id="maxSteps" value="10" min="1" max="100">
                        <div class="form-help">é˜²æ­¢æ™ºèƒ½ä½“é™·å…¥æ— é™å¾ªç¯</div>
                    </div>

                    <div class="form-group">
                        <label>é£é™©ç­‰çº§</label>
                        <select id="riskLevel">
                            <option value="low">ä½å± - ä»…åªè¯»æ“ä½œ</option>
                            <option value="medium">ä¸­å± - å¯æ‰§è¡Œè„šæœ¬å’ŒæŸ¥è¯¢</option>
                            <option value="high">é«˜å± - å¯ä¿®æ”¹æ–‡ä»¶å’Œç³»ç»Ÿ</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>å¯ç”¨å·¥å…·</label>
                        <div class="tools-selector" id="toolsSelector">
                            <!-- å·¥å…·å¤é€‰æ¡†å°†ç”± JS ç”Ÿæˆ -->
                        </div>
                        <div class="form-help">é€‰æ‹©è¯¥æ™ºèƒ½ä½“å¯ä»¥ä½¿ç”¨çš„å·¥å…·</div>
                    </div>

                    <div class="form-group">
                        <label>åœæ­¢æ¡ä»¶</label>
                        <textarea id="stopCondition" rows="3" placeholder='ä¾‹å¦‚ï¼š{"max_errors": 3, "timeout_minutes": 30}'></textarea>
                        <div class="form-help">JSON æ ¼å¼ï¼Œå®šä¹‰æ™ºèƒ½ä½“ä½•æ—¶è‡ªåŠ¨åœæ­¢</div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal()">å–æ¶ˆ</button>
                <button class="btn btn-primary" onclick="saveAgent()">ä¿å­˜</button>
            </div>
        </div>
    </div>

    <!-- æ‰§è¡Œè®¡åˆ’æ¨¡æ€æ¡† -->
    <div class="modal" id="planModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>æ‰§è¡Œè®¡åˆ’</h2>
                <button class="close-btn" onclick="closePlanModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div style="margin-bottom: 20px;">
                    <div style="font-size: 16px; font-weight: 600; margin-bottom: 10px;">
                        ç›®æ ‡ä»»åŠ¡
                    </div>
                    <div style="padding: 15px; background: var(--bg-darker); border-radius: 6px; border: 1px solid var(--border-color);">
                        <div id="planGoal">åˆ†æç³»ç»Ÿæ—¥å¿—ï¼Œæ‰¾å‡ºæœ€è¿‘çš„é”™è¯¯å¹¶ç”ŸæˆæŠ¥å‘Š</div>
                    </div>
                </div>

                <div style="margin-bottom: 15px; display: flex; justify-content: space-between; align-items: center;">
                    <div style="font-size: 16px; font-weight: 600;">æ‰§è¡Œæ­¥éª¤</div>
                    <div style="display: flex; gap: 10px;">
                        <button class="btn btn-sm btn-secondary">â¸ æš‚åœ</button>
                        <button class="btn btn-sm btn-danger">â¹ åœæ­¢</button>
                    </div>
                </div>

                <div class="plan-steps" id="planSteps">
                    <!-- æ­¥éª¤å°†ç”± JS ç”Ÿæˆ -->
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closePlanModal()">å…³é—­</button>
            </div>
        </div>
    </div>

    <script src="assets/common.js"></script>
    <script>
        // ç¤ºä¾‹æ•°æ®
        const agents = [
            {
                id: 'agent-1',
                name: 'DevOps åŠ©æ‰‹',
                icon: 'âš™ï¸',
                description: 'è‡ªåŠ¨æ‰§è¡Œä»£ç æ‹‰å–ã€æ„å»ºã€æµ‹è¯•å’Œæ—¥å¿—åˆ†æä»»åŠ¡',
                model: 'qwen-plus',
                risk: 'high',
                enabled: true,
                tools: ['ShellOps', 'FsOps', 'ProcessOps', 'GitOps', 'NetOps'],
                maxSteps: 15,
                stats: {
                    runs: 24,
                    success: 22,
                    lastRun: '2 å°æ—¶å‰'
                }
            },
            {
                id: 'agent-2',
                name: 'çŸ¥è¯†æ•´ç†åŠ©æ‰‹',
                icon: 'ğŸ“š',
                description: 'æ‰«ææ–‡æ¡£ç›®å½•ï¼Œè‡ªåŠ¨åˆ†å—ç´¢å¼•å¹¶ç”ŸæˆçŸ¥è¯†åº“',
                model: 'qwen-max',
                risk: 'low',
                enabled: true,
                tools: ['FsOps', 'VectorIndexer', 'BailianChat', 'RAG'],
                maxSteps: 10,
                stats: {
                    runs: 15,
                    success: 15,
                    lastRun: 'æ˜¨å¤©'
                }
            },
            {
                id: 'agent-3',
                name: 'ç³»ç»Ÿå·¡æ£€åŠ©æ‰‹',
                icon: 'ğŸ”',
                description: 'å®šæ—¶æ£€æŸ¥ç³»ç»Ÿèµ„æºçŠ¶æ€å¹¶ç”Ÿæˆç›‘æ§æŠ¥å‘Š',
                model: 'qwen-turbo',
                risk: 'medium',
                enabled: true,
                tools: ['ProcessOps', 'NetOps', 'FsOps', 'ShellOps'],
                maxSteps: 8,
                stats: {
                    runs: 48,
                    success: 46,
                    lastRun: '30 åˆ†é’Ÿå‰'
                }
            },
            {
                id: 'agent-4',
                name: 'ä»£ç å®¡æŸ¥åŠ©æ‰‹',
                icon: 'ğŸ”',
                description: 'è‡ªåŠ¨åˆ†æä»£ç å˜æ›´ï¼Œç”Ÿæˆå®¡æŸ¥æŠ¥å‘Šå’Œæ”¹è¿›å»ºè®®',
                model: 'qwen-max',
                risk: 'low',
                enabled: false,
                tools: ['GitOps', 'FsOps'],
                maxSteps: 12,
                stats: {
                    runs: 0,
                    success: 0,
                    lastRun: 'ä»æœªè¿è¡Œ'
                }
            },
            {
                id: 'agent-5',
                name: 'æ•°æ®åŒæ­¥åŠ©æ‰‹',
                icon: 'ğŸ”„',
                description: 'åœ¨ä¸åŒç³»ç»Ÿé—´è‡ªåŠ¨åŒæ­¥æ•°æ®å’Œæ–‡ä»¶',
                model: 'llama3:8b',
                risk: 'high',
                enabled: true,
                tools: ['FsOps', 'NetOps', 'HttpConnector', 'DatabaseConnector'],
                maxSteps: 20,
                stats: {
                    runs: 36,
                    success: 34,
                    lastRun: '1 å°æ—¶å‰'
                }
            },
            {
                id: 'agent-6',
                name: 'æ–‡æ¡£ç”ŸæˆåŠ©æ‰‹',
                icon: 'ğŸ“',
                description: 'æ ¹æ®ä»£ç å’Œæ³¨é‡Šè‡ªåŠ¨ç”ŸæˆæŠ€æœ¯æ–‡æ¡£',
                model: 'qwen-plus',
                risk: 'low',
                enabled: true,
                tools: ['FsOps', 'GitOps'],
                maxSteps: 8,
                stats: {
                    runs: 12,
                    success: 11,
                    lastRun: '3 å¤©å‰'
                }
            }
        ];

        const availableTools = [
            'FsOps', 'ShellOps', 'ProcessOps', 'NetOps', 'ClipboardOps', 'UIAutoOps',
            'GitOps', 'VectorIndexer', 'BailianChat', 'RAG',
            'HttpConnector', 'EmailConnector', 'DatabaseConnector'
        ];

        // æ¸²æŸ“æ™ºèƒ½ä½“åˆ—è¡¨
        function renderAgents() {
            const grid = document.getElementById('agentsGrid');
            grid.innerHTML = agents.map(agent => `
                <div class="agent-card">
                    <div class="toggle-switch ${agent.enabled ? 'active' : ''}"
                         onclick="toggleAgent('${agent.id}')"
                         title="${agent.enabled ? 'å·²å¯ç”¨' : 'å·²ç¦ç”¨'}">
                    </div>

                    <div class="agent-card-header">
                        <div class="agent-icon">${agent.icon}</div>
                        <div class="agent-info">
                            <h3 class="agent-name">${agent.name}</h3>
                        </div>
                    </div>

                    <div class="agent-description">${agent.description}</div>

                    <div class="agent-meta">
                        <span class="meta-item">
                            <span>ğŸ¤–</span> ${agent.model}
                        </span>
                        <span class="meta-item">
                            <span>ğŸ“Š</span> æœ€å¤š ${agent.maxSteps} æ­¥
                        </span>
                        <span class="risk-badge ${agent.risk}">
                            ${agent.risk === 'low' ? 'ä½å±' : agent.risk === 'medium' ? 'ä¸­å±' : 'é«˜å±'}
                        </span>
                    </div>

                    <div class="agent-tools">
                        <div class="tools-label">å¯ç”¨å·¥å…· (${agent.tools.length})</div>
                        <div class="tools-list">
                            ${agent.tools.map(tool => `<span class="tool-tag">${tool}</span>`).join('')}
                        </div>
                    </div>

                    <div class="stats-row">
                        <div class="stat-item">
                            <span>â–¶ï¸</span> è¿è¡Œ ${agent.stats.runs} æ¬¡
                        </div>
                        <div class="stat-item">
                            <span>âœ…</span> æˆåŠŸ ${agent.stats.success} æ¬¡
                        </div>
                        <div class="stat-item">
                            <span>ğŸ•</span> ${agent.stats.lastRun}
                        </div>
                    </div>

                    <div class="agent-actions">
                        <button class="btn btn-sm btn-primary" onclick="runAgent('${agent.id}')"
                                ${!agent.enabled ? 'disabled' : ''}>
                            â–¶ï¸ è¿è¡Œ
                        </button>
                        <button class="btn btn-sm btn-secondary" onclick="editAgent('${agent.id}')">
                            âœï¸ ç¼–è¾‘
                        </button>
                        <button class="btn btn-sm btn-secondary" onclick="viewHistory('${agent.id}')">
                            ğŸ“Š å†å²
                        </button>
                        <button class="btn btn-sm btn-danger" onclick="deleteAgent('${agent.id}')">
                            ğŸ—‘ï¸
                        </button>
                    </div>
                </div>
            `).join('');
        }

        // æ¸²æŸ“å·¥å…·é€‰æ‹©å™¨
        function renderToolsSelector() {
            const selector = document.getElementById('toolsSelector');
            selector.innerHTML = availableTools.map(tool => `
                <label class="tool-checkbox">
                    <input type="checkbox" value="${tool}">
                    <span>${tool}</span>
                </label>
            `).join('');
        }

        // åˆ›å»ºæ™ºèƒ½ä½“
        function createAgent() {
            document.getElementById('modalTitle').textContent = 'åˆ›å»ºæ™ºèƒ½ä½“';
            document.getElementById('agentForm').reset();
            renderToolsSelector();
            document.getElementById('agentModal').classList.add('show');
        }

        // ç¼–è¾‘æ™ºèƒ½ä½“
        function editAgent(id) {
            const agent = agents.find(a => a.id === id);
            if (!agent) return;

            document.getElementById('modalTitle').textContent = 'ç¼–è¾‘æ™ºèƒ½ä½“';
            document.getElementById('agentName').value = agent.name;
            document.getElementById('agentDescription').value = agent.description;
            document.getElementById('agentModel').value = agent.model;
            document.getElementById('maxSteps').value = agent.maxSteps;
            document.getElementById('riskLevel').value = agent.risk;

            renderToolsSelector();
            // é€‰ä¸­å·²æœ‰å·¥å…·
            agent.tools.forEach(tool => {
                const checkbox = document.querySelector(`input[value="${tool}"]`);
                if (checkbox) checkbox.checked = true;
            });

            document.getElementById('agentModal').classList.add('show');
        }

        // è¿è¡Œæ™ºèƒ½ä½“
        function runAgent(id) {
            const agent = agents.find(a => a.id === id);
            if (!agent) return;

            // å¼¹å‡ºæ‰§è¡Œè®¡åˆ’ç•Œé¢
            showPlanExecution(agent);
        }

        // æ˜¾ç¤ºæ‰§è¡Œè®¡åˆ’
        function showPlanExecution(agent) {
            const steps = [
                { number: 1, name: 'åˆ†æä»»åŠ¡éœ€æ±‚', type: 'LLMè°ƒç”¨', status: 'completed', duration: '1.2s' },
                { number: 2, name: 'è¯»å–æ—¥å¿—æ–‡ä»¶', type: 'FsOps', status: 'completed', duration: '0.5s' },
                { number: 3, name: 'è§£ææ—¥å¿—å†…å®¹', type: 'LLMè°ƒç”¨', status: 'completed', duration: '2.1s' },
                { number: 4, name: 'æå–é”™è¯¯ä¿¡æ¯', type: 'ShellOps', status: 'completed', duration: '0.8s' },
                { number: 5, name: 'ç”Ÿæˆåˆ†ææŠ¥å‘Š', type: 'LLMè°ƒç”¨', status: 'running', duration: '-' },
                { number: 6, name: 'ä¿å­˜æŠ¥å‘Šæ–‡ä»¶', type: 'FsOps', status: 'pending', duration: '-' }
            ];

            const stepsHtml = steps.map(step => `
                <div class="step-item ${step.status}">
                    <div class="step-number">${step.number}</div>
                    <div class="step-info">
                        <div class="step-name">${step.name}</div>
                        <div class="step-details">
                            ç±»å‹: ${step.type} | è€—æ—¶: ${step.duration}
                            ${step.status === 'running' ? '<span style="color: var(--primary-color)">â— æ‰§è¡Œä¸­...</span>' : ''}
                        </div>
                    </div>
                    <div class="step-actions">
                        ${step.status === 'pending' ? '<button class="btn btn-sm btn-secondary">â­ è·³è¿‡</button>' : ''}
                        ${step.status === 'completed' || step.status === 'failed' ? '<button class="btn btn-sm btn-secondary">ğŸ”„ é‡è·‘</button>' : ''}
                    </div>
                </div>
            `).join('');

            document.getElementById('planSteps').innerHTML = stepsHtml;
            document.getElementById('planModal').classList.add('show');
        }

        // åˆ‡æ¢æ™ºèƒ½ä½“å¯ç”¨çŠ¶æ€
        function toggleAgent(id) {
            const agent = agents.find(a => a.id === id);
            if (agent) {
                agent.enabled = !agent.enabled;
                renderAgents();
                Utils.showToast(agent.enabled ? 'æ™ºèƒ½ä½“å·²å¯ç”¨' : 'æ™ºèƒ½ä½“å·²ç¦ç”¨', 'success');
            }
        }

        // åˆ é™¤æ™ºèƒ½ä½“
        function deleteAgent(id) {
            if (confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªæ™ºèƒ½ä½“å—?')) {
                const index = agents.findIndex(a => a.id === id);
                if (index !== -1) {
                    agents.splice(index, 1);
                    renderAgents();
                    Utils.showToast('æ™ºèƒ½ä½“å·²åˆ é™¤', 'success');
                }
            }
        }

        // æŸ¥çœ‹å†å²
        function viewHistory(id) {
            Utils.showToast('è·³è½¬åˆ°è¿è¡Œè®°å½•é¡µé¢...', 'info');
            setTimeout(() => {
                window.location.href = 'jobs.html?agent=' + id;
            }, 500);
        }

        // ä¿å­˜æ™ºèƒ½ä½“
        function saveAgent() {
            const name = document.getElementById('agentName').value;
            if (!name) {
                Utils.showToast('è¯·è¾“å…¥æ™ºèƒ½ä½“åç§°', 'warning');
                return;
            }

            const selectedTools = Array.from(document.querySelectorAll('#toolsSelector input:checked'))
                .map(cb => cb.value);

            Utils.showToast('æ™ºèƒ½ä½“å·²ä¿å­˜', 'success');
            closeModal();
        }

        // å…³é—­æ¨¡æ€æ¡†
        function closeModal() {
            document.getElementById('agentModal').classList.remove('show');
        }

        function closePlanModal() {
            document.getElementById('planModal').classList.remove('show');
        }

        // æ˜¾ç¤ºæ¨¡æ¿
        function showTemplates() {
            Utils.showToast('æ¨¡æ¿åŠŸèƒ½å¼€å‘ä¸­...', 'info');
        }

        // åˆå§‹åŒ–
        renderAgents();
    </script>
</body>
</html>
