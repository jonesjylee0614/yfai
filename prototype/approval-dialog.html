<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ“ä½œå®¡æ‰¹</title>
    <link rel="stylesheet" href="assets/common.css">
    <style>
        body {
            padding: 0;
            overflow-y: auto;
        }

        .approval-container {
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
        }

        .approval-header {
            text-align: center;
            margin-bottom: 24px;
        }

        .approval-icon {
            font-size: 48px;
            margin-bottom: 12px;
        }

        .approval-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .approval-subtitle {
            color: var(--text-secondary);
            font-size: 14px;
        }

        .risk-banner {
            padding: 12px 16px;
            border-radius: var(--radius);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 12px;
            font-weight: 600;
        }

        .risk-low {
            background: rgba(82, 196, 26, 0.2);
            border: 1px solid var(--success-color);
            color: var(--success-color);
        }

        .risk-medium {
            background: rgba(250, 173, 20, 0.2);
            border: 1px solid var(--warning-color);
            color: var(--warning-color);
        }

        .risk-high {
            background: rgba(255, 77, 79, 0.2);
            border: 1px solid var(--danger-color);
            color: var(--danger-color);
        }

        .risk-critical {
            background: var(--danger-color);
            color: white;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
        }

        .info-section {
            background: var(--bg-light);
            border: 1px solid var(--border-color);
            border-radius: var(--radius);
            padding: 16px;
            margin-bottom: 16px;
        }

        .info-section-title {
            font-weight: 600;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .info-row {
            display: flex;
            margin-bottom: 8px;
            font-size: 13px;
        }

        .info-label {
            min-width: 100px;
            color: var(--text-secondary);
        }

        .info-value {
            flex: 1;
            color: var(--text-primary);
            word-break: break-all;
        }

        .code-preview {
            background: var(--bg-darker);
            border: 1px solid var(--border-color);
            border-radius: var(--radius);
            padding: 12px;
            margin: 12px 0;
            max-height: 200px;
            overflow-y: auto;
        }

        .code-preview code {
            font-size: 12px;
            color: #a8daff;
            white-space: pre-wrap;
            word-break: break-all;
        }

        .impact-list {
            list-style: none;
            padding: 0;
            margin: 12px 0;
        }

        .impact-item {
            padding: 8px 12px;
            background: var(--bg-darker);
            border-left: 3px solid var(--warning-color);
            margin-bottom: 8px;
            font-size: 13px;
            border-radius: 4px;
        }

        .impact-item.critical {
            border-left-color: var(--danger-color);
        }

        .checklist {
            margin: 16px 0;
        }

        .checklist-item {
            display: flex;
            align-items: center;
            padding: 8px;
            margin-bottom: 4px;
        }

        .checklist-item input[type="checkbox"] {
            margin-right: 8px;
            width: 16px;
            height: 16px;
            cursor: pointer;
        }

        .actions {
            display: flex;
            gap: 12px;
            margin-top: 24px;
        }

        .actions .btn {
            flex: 1;
            padding: 12px;
            font-size: 15px;
            font-weight: 600;
        }

        .timer {
            text-align: center;
            margin-top: 12px;
            font-size: 12px;
            color: var(--text-secondary);
        }

        .details-toggle {
            cursor: pointer;
            color: var(--primary-color);
            text-align: center;
            padding: 8px;
            margin: 12px 0;
            font-size: 13px;
        }

        .details-toggle:hover {
            text-decoration: underline;
        }

        .details-content {
            display: none;
        }

        .details-content.show {
            display: block;
        }

        .warning-box {
            background: rgba(255, 77, 79, 0.1);
            border: 1px solid var(--danger-color);
            border-radius: var(--radius);
            padding: 12px;
            margin: 16px 0;
        }

        .warning-box-title {
            color: var(--danger-color);
            font-weight: 600;
            margin-bottom: 8px;
        }

        .warning-box-content {
            font-size: 13px;
            color: var(--text-secondary);
        }
    </style>
</head>
<body>
    <div class="approval-container">
        <!-- å¤´éƒ¨ -->
        <div class="approval-header">
            <div class="approval-icon">âš ï¸</div>
            <div class="approval-title">æ“ä½œå®¡æ‰¹è¯·æ±‚</div>
            <div class="approval-subtitle">è¯·ä»”ç»†å®¡æŸ¥ä»¥ä¸‹æ“ä½œå†…å®¹</div>
        </div>

        <!-- é£é™©ç­‰çº§ -->
        <div class="risk-banner risk-medium" id="riskBanner">
            <span>âš¡</span>
            <span>é£é™©ç­‰çº§ï¼šä¸­å±</span>
        </div>

        <!-- åŸºæœ¬ä¿¡æ¯ -->
        <div class="info-section">
            <div class="info-section-title">
                <span>ğŸ“‹</span>
                <span>æ“ä½œä¿¡æ¯</span>
            </div>
            <div class="info-row">
                <div class="info-label">æ“ä½œç±»å‹ï¼š</div>
                <div class="info-value">Shell è„šæœ¬æ‰§è¡Œ</div>
            </div>
            <div class="info-row">
                <div class="info-label">å·¥å…·åç§°ï¼š</div>
                <div class="info-value">PowerShell</div>
            </div>
            <div class="info-row">
                <div class="info-label">è¯·æ±‚æ¥æºï¼š</div>
                <div class="info-value">LLM è‡ªåŠ¨å†³ç­–</div>
            </div>
            <div class="info-row">
                <div class="info-label">è¯·æ±‚æ—¶é—´ï¼š</div>
                <div class="info-value" id="requestTime">2025-11-12 23:00:00</div>
            </div>
        </div>

        <!-- å‘½ä»¤é¢„è§ˆ -->
        <div class="info-section">
            <div class="info-section-title">
                <span>ğŸ’»</span>
                <span>å‘½ä»¤å†…å®¹</span>
            </div>
            <div class="code-preview">
                <code id="commandPreview">Get-Process | Sort-Object CPU -Descending | Select-Object -First 10</code>
            </div>
            <div class="details-toggle" onclick="toggleDetails()">
                <span id="detailsToggleText">â–¼ æŸ¥çœ‹è¯¦ç»†å‚æ•°</span>
            </div>
            <div class="details-content" id="detailsContent">
                <div class="info-row">
                    <div class="info-label">å·¥ä½œç›®å½•ï¼š</div>
                    <div class="info-value">D:\WorkSpace\aipros\yfai</div>
                </div>
                <div class="info-row">
                    <div class="info-label">è¶…æ—¶è®¾ç½®ï¼š</div>
                    <div class="info-value">30 ç§’</div>
                </div>
                <div class="info-row">
                    <div class="info-label">ç¯å¢ƒå˜é‡ï¼š</div>
                    <div class="info-value">ç»§æ‰¿å½“å‰ç¯å¢ƒ</div>
                </div>
            </div>
        </div>

        <!-- å½±å“è¯„ä¼° -->
        <div class="info-section">
            <div class="info-section-title">
                <span>ğŸ¯</span>
                <span>å½±å“è¯„ä¼°</span>
            </div>
            <ul class="impact-list">
                <li class="impact-item">âœ“ è¯¥å‘½ä»¤ä»…æ‰§è¡Œåªè¯»æ“ä½œ</li>
                <li class="impact-item">âœ“ ä¸ä¼šä¿®æ”¹ä»»ä½•æ–‡ä»¶æˆ–é…ç½®</li>
                <li class="impact-item">âš ï¸ éœ€è¦è®¿é—®è¿›ç¨‹åˆ—è¡¨ä¿¡æ¯</li>
                <li class="impact-item">âœ“ æ‰§è¡Œæ—¶é—´é¢„è®¡å°äº 5 ç§’</li>
            </ul>
        </div>

        <!-- å®‰å…¨è­¦å‘Šï¼ˆé«˜å±æ“ä½œæ—¶æ˜¾ç¤ºï¼‰ -->
        <div class="warning-box" style="display: none;" id="warningBox">
            <div class="warning-box-title">â›” å±é™©æ“ä½œè­¦å‘Š</div>
            <div class="warning-box-content">
                æ­¤æ“ä½œå¯èƒ½ä¼šï¼š
                <ul style="margin: 8px 0; padding-left: 20px;">
                    <li>åˆ é™¤æˆ–ä¿®æ”¹é‡è¦æ–‡ä»¶</li>
                    <li>æ›´æ”¹ç³»ç»Ÿé…ç½®</li>
                    <li>å½±å“æ­£åœ¨è¿è¡Œçš„æœåŠ¡</li>
                </ul>
                è¯·ç¡®è®¤æ‚¨å®Œå…¨ç†è§£æ­¤æ“ä½œçš„åæœã€‚
            </div>
        </div>

        <!-- ç¡®è®¤æ¸…å• -->
        <div class="info-section">
            <div class="info-section-title">
                <span>âœ…</span>
                <span>å®‰å…¨ç¡®è®¤</span>
            </div>
            <div class="checklist">
                <label class="checklist-item">
                    <input type="checkbox" id="check1" onchange="updateApproveButton()">
                    <span>æˆ‘å·²ä»”ç»†é˜…è¯»æ“ä½œå†…å®¹</span>
                </label>
                <label class="checklist-item">
                    <input type="checkbox" id="check2" onchange="updateApproveButton()">
                    <span>æˆ‘ç†è§£æ­¤æ“ä½œçš„å½±å“èŒƒå›´</span>
                </label>
                <label class="checklist-item">
                    <input type="checkbox" id="check3" onchange="updateApproveButton()">
                    <span>æˆ‘ç¡®è®¤æ‰¹å‡†æ­¤æ“ä½œ</span>
                </label>
            </div>
        </div>

        <!-- æ“ä½œæŒ‰é’® -->
        <div class="actions">
            <button class="btn btn-danger" onclick="handleReject()">
                âœ– æ‹’ç»
            </button>
            <button class="btn btn-success" id="approveBtn" onclick="handleApprove()" disabled>
                âœ“ æ‰¹å‡†æ‰§è¡Œ
            </button>
        </div>

        <!-- å€’è®¡æ—¶ -->
        <div class="timer" id="timer">
            æ­¤è¯·æ±‚å°†åœ¨ 60 ç§’åè‡ªåŠ¨æ‹’ç»
        </div>
    </div>

    <script src="assets/common.js"></script>
    <script>
        let timeLeft = 60;
        let timerInterval;

        // åˆå§‹åŒ–
        window.onload = function() {
            document.getElementById('requestTime').textContent = Utils.formatTime(new Date());
            startTimer();
        };

        // å€’è®¡æ—¶
        function startTimer() {
            timerInterval = setInterval(() => {
                timeLeft--;
                document.getElementById('timer').textContent = `æ­¤è¯·æ±‚å°†åœ¨ ${timeLeft} ç§’åè‡ªåŠ¨æ‹’ç»`;
                
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    handleReject(true);
                }
            }, 1000);
        }

        // åˆ‡æ¢è¯¦æƒ…
        function toggleDetails() {
            const content = document.getElementById('detailsContent');
            const toggleText = document.getElementById('detailsToggleText');
            
            if (content.classList.contains('show')) {
                content.classList.remove('show');
                toggleText.textContent = 'â–¼ æŸ¥çœ‹è¯¦ç»†å‚æ•°';
            } else {
                content.classList.add('show');
                toggleText.textContent = 'â–² æ”¶èµ·è¯¦ç»†å‚æ•°';
            }
        }

        // æ›´æ–°æ‰¹å‡†æŒ‰é’®çŠ¶æ€
        function updateApproveButton() {
            const check1 = document.getElementById('check1').checked;
            const check2 = document.getElementById('check2').checked;
            const check3 = document.getElementById('check3').checked;
            const approveBtn = document.getElementById('approveBtn');
            
            if (check1 && check2 && check3) {
                approveBtn.disabled = false;
            } else {
                approveBtn.disabled = true;
            }
        }

        // æ‰¹å‡†æ“ä½œ
        function handleApprove() {
            clearInterval(timerInterval);
            
            const result = {
                action: 'approve',
                timestamp: new Date().toISOString(),
                command: document.getElementById('commandPreview').textContent
            };
            
            // æ˜¾ç¤ºç¡®è®¤ä¿¡æ¯
            showResultScreen('approved');
            
            // 3ç§’åå…³é—­çª—å£
            setTimeout(() => {
                if (window.opener) {
                    window.opener.postMessage(result, '*');
                }
                window.close();
            }, 3000);
        }

        // æ‹’ç»æ“ä½œ
        function handleReject(auto = false) {
            clearInterval(timerInterval);
            
            const result = {
                action: 'reject',
                timestamp: new Date().toISOString(),
                auto: auto
            };
            
            // æ˜¾ç¤ºæ‹’ç»ä¿¡æ¯
            showResultScreen('rejected', auto);
            
            // 2ç§’åå…³é—­çª—å£
            setTimeout(() => {
                if (window.opener) {
                    window.opener.postMessage(result, '*');
                }
                window.close();
            }, 2000);
        }

        // æ˜¾ç¤ºç»“æœå±å¹•
        function showResultScreen(type, auto = false) {
            const container = document.querySelector('.approval-container');
            
            if (type === 'approved') {
                container.innerHTML = `
                    <div style="text-align: center; padding: 60px 20px;">
                        <div style="font-size: 64px; margin-bottom: 20px;">âœ…</div>
                        <div style="font-size: 24px; font-weight: 600; margin-bottom: 12px;">
                            æ“ä½œå·²æ‰¹å‡†
                        </div>
                        <div style="color: var(--text-secondary);">
                            æ­£åœ¨æ‰§è¡Œå‘½ä»¤...
                        </div>
                        <div style="margin-top: 20px;">
                            <div class="loading"></div>
                        </div>
                    </div>
                `;
            } else {
                container.innerHTML = `
                    <div style="text-align: center; padding: 60px 20px;">
                        <div style="font-size: 64px; margin-bottom: 20px;">âŒ</div>
                        <div style="font-size: 24px; font-weight: 600; margin-bottom: 12px;">
                            æ“ä½œå·²${auto ? 'è‡ªåŠ¨' : ''}æ‹’ç»
                        </div>
                        <div style="color: var(--text-secondary);">
                            ${auto ? 'è¯·æ±‚è¶…æ—¶ï¼Œå·²è‡ªåŠ¨æ‹’ç»' : 'æ‚¨å·²æ‹’ç»æ­¤æ“ä½œè¯·æ±‚'}
                        </div>
                    </div>
                `;
            }
        }

        // æ¨¡æ‹Ÿä¸åŒé£é™©ç­‰çº§ï¼ˆå¯æ ¹æ®å®é™…æƒ…å†µåŠ¨æ€è®¾ç½®ï¼‰
        function setRiskLevel(level) {
            const banner = document.getElementById('riskBanner');
            const warningBox = document.getElementById('warningBox');
            
            banner.className = 'risk-banner';
            
            switch(level) {
                case 'low':
                    banner.classList.add('risk-low');
                    banner.innerHTML = '<span>âœ“</span><span>é£é™©ç­‰çº§ï¼šä½å±</span>';
                    break;
                case 'medium':
                    banner.classList.add('risk-medium');
                    banner.innerHTML = '<span>âš¡</span><span>é£é™©ç­‰çº§ï¼šä¸­å±</span>';
                    break;
                case 'high':
                    banner.classList.add('risk-high');
                    banner.innerHTML = '<span>âš ï¸</span><span>é£é™©ç­‰çº§ï¼šé«˜å±</span>';
                    warningBox.style.display = 'block';
                    break;
                case 'critical':
                    banner.classList.add('risk-critical');
                    banner.innerHTML = '<span>ğŸš¨</span><span>é£é™©ç­‰çº§ï¼šä¸¥é‡</span>';
                    warningBox.style.display = 'block';
                    break;
            }
        }
    </script>
</body>
</html>

